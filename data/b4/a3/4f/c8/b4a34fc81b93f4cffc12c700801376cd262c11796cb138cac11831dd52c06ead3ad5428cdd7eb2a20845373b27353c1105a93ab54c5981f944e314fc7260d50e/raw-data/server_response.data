<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/keystone/+bug/1872733/+index" />

    <meta charset="UTF-8" />
    <title>Bug #1872733 “[OSSA-2020-004] Keystone V3 /credentials endpoint ...” : Bugs : OpenStack Identity (keystone)</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/1872733" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/1872733/bug.atom" title="Bug 1872733 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="&quot;_build_target_enforcement&quot; function checks only for &quot;credential_id&quot;: https://github.com/openstack/keystone/blob/7bb6314e40d6947294260324e84a58de191f8609/keystone/api/credentials.py#L38

Thus even having a '&quot;identity:update_credential&quot;: &quot;rule:cloud_admin or (user_id:%(target.credential.user_id)s)&quot;' policy doesn't prevent a malicious user to create an EC2 credential, then change its owner and project ID, e.g.:

curl -X PATCH https://keystone/v3/credentials/3c2b3265350c6da3a18a143fbe975ca4a8ed8..." />
      <meta property="og:description" content="&quot;_build_target_enforcement&quot; function checks only for &quot;credential_id&quot;: https://github.com/openstack/keystone/blob/7bb6314e40d6947294260324e84a58de191f8609/keystone/api/credentials.py#L38

Thus even having a '&quot;identity:update_credential&quot;: &quot;rule:cloud_admin or (user_id:%(target.credential.user_id)s)&quot;' policy doesn't prevent a malicious user to create an EC2 credential, then change its owner and project ID, e.g.:

curl -X PATCH https://keystone/v3/credentials/3c2b3265350c6da3a18a143fbe975ca4a8ed8..." />
    

    
    
      <meta property="og:title" content="Bug #1872733 “[OSSA-2020-004] Keystone V3 /credentials endpoint ...” : Bugs : OpenStack Identity (keystone)" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/1872733" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["api-ref", "caching", "configuration", "default-roles", "documentation", "federation", "fernet", "fix-requires-microversion", "hierarchical-multitenancy", "i18n", "jwt", "ldap", "limits", "logging", "low-hanging-fruit", "meeting-topic", "notifications", "ocata-backport-potential", "office-hours", "ops", "password", "pci", "performance", "pike-backport-potential", "pki", "policy", "python3", "queens-backport-potential", "rc-potential", "revoke", "rfe", "rocky-backport-potential", "security", "sql", "system-scope", "test-improvement", "trusts", "upgrades", "user-experience", "x509"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/keystone/+bug/1872733/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/keystone"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/keystone">OpenStack Identity (keystone)</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/keystone">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/keystone">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/keystone">Bugs</a></li>
      
      
    
    
      
      <li class="specifications"><a href="https://blueprints.launchpad.net/keystone">Blueprints</a></li>
      
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/keystone">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/keystone">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    [OSSA-2020-004] Keystone V3 /credentials endpoint policy logic allows to change credentials owner or target project ID (CVE-2020-12691)
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #1872733 reported by
      <a href="https://launchpad.net/~kay-diam" class="sprite person">kay</a>
      <time title="2020-04-14 14:44:26 UTC" datetime="2020-04-14T14:44:26.767032+00:00">on 2020-04-14</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">264</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 1 person</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary2591941">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/keystone/+bug/1872733/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2591941">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/keystone">OpenStack Identity (keystone)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/keystone/+bug/1872733/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/keystone/+bug/1872733/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceHIGH">High</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2591941">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~krinkle">Colleen Murphy</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2591941">
     <td colspan="7"><form action="/keystone/+bug/1872733/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/keystone">OpenStack Identity (keystone)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~kay-diam" class="sprite person">kay</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2020-04-14 14:44:26 UTC" datetime="2020-04-14T14:44:26.767032+00:00">2020-04-14</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2020-04-14 22:01:49 UTC" datetime="2020-04-14T22:01:49.856975+00:00">2020-04-14</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2020-04-15 00:26:38 UTC" datetime="2020-04-15T00:26:38.284599+00:00">2020-04-15</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2020-04-15 00:26:43 UTC" datetime="2020-04-15T00:26:43.318651+00:00">2020-04-15</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2020-05-08 16:14:54 UTC" datetime="2020-05-08T16:14:54.037900+00:00">2020-05-08</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="keystone.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="keystone.target.option.package" name="keystone.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="keystone.target.distribution" name="keystone.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="keystone.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="keystone.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="keystone.target.package"
                         name="keystone.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;keystone.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('keystone.target.package');
              var select_menu = Y.DOM.byId('keystone.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-keystone-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_remove_button": false, "header": "Select a package", "vocabulary_filters": [], "remove_team_text": "Remove team", "remove_person_text": "Remove person", "selected_value_metadata": null, "show_create_team": false, "picker_type": "default", "vocabulary_name": "DistributionPackage", "extra_no_results_message": null, "selected_value": null, "show_assign_me_button": false, "show_widget_id": "show-widget-keystone-target-package", "step_title": "Search by name", "assign_me_text": "Pick me", "input_element": "keystone.target.package"};
        var show_widget_id = 'show-widget-keystone-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="keystone.target.option.product" name="keystone.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="keystone" id="keystone.target.product"
                         name="keystone.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;keystone.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('keystone.target.product');
              var select_menu = Y.DOM.byId('keystone.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-keystone-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_remove_button": false, "header": "Select a project", "vocabulary_filters": [], "remove_team_text": "Remove team", "remove_person_text": "Remove person", "selected_value_metadata": null, "show_create_team": false, "picker_type": "default", "vocabulary_name": "Product", "extra_no_results_message": null, "selected_value": "keystone", "show_assign_me_button": false, "show_widget_id": "show-widget-keystone-target-product", "step_title": "Search", "assign_me_text": "Pick me", "input_element": "keystone.target.product"};
        var show_widget_id = 'show-widget-keystone-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="keystone.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="keystone.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="keystone.status" name="keystone.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="keystone.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceHIGH">High</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="keystone.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="keystone.assignee.assign_to_me" name="keystone.assignee.option" value="keystone.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="keystone.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="keystone.assignee.assigned_to" name="keystone.assignee.option" value="keystone.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="keystone.assignee.assigned_to">
              Colleen Murphy (krinkle)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="keystone.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="keystone.comment_on_change" name="keystone.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary2591945">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ossa/+bug/1872733/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2591945">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ossa">OpenStack Security Advisory</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ossa/+bug/1872733/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/ossa/+bug/1872733/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2591945">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2591945">
     <td colspan="7"><form action="/ossa/+bug/1872733/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ossa">OpenStack Security Advisory</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2020-04-14 15:04:06 UTC" datetime="2020-04-14T15:04:06.197977+00:00">2020-04-14</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2020-05-06 18:04:50 UTC" datetime="2020-05-06T18:04:50.950373+00:00">2020-05-06</time>
      </td>
    </tr>
    
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2020-05-06 18:04:50 UTC" datetime="2020-05-06T18:04:50.950373+00:00">2020-05-06</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2020-05-06 18:57:38 UTC" datetime="2020-05-06T18:57:38.369617+00:00">2020-05-06</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ossa.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="ossa.target.option.package" name="ossa.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ossa.target.distribution" name="ossa.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ossa.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ossa.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ossa.target.package"
                         name="ossa.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ossa.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ossa.target.package');
              var select_menu = Y.DOM.byId('ossa.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ossa-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_remove_button": false, "header": "Select a package", "vocabulary_filters": [], "remove_team_text": "Remove team", "remove_person_text": "Remove person", "selected_value_metadata": null, "show_create_team": false, "picker_type": "default", "vocabulary_name": "DistributionPackage", "extra_no_results_message": null, "selected_value": null, "show_assign_me_button": false, "show_widget_id": "show-widget-ossa-target-package", "step_title": "Search by name", "assign_me_text": "Pick me", "input_element": "ossa.target.package"};
        var show_widget_id = 'show-widget-ossa-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ossa.target.option.product" name="ossa.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="ossa" id="ossa.target.product"
                         name="ossa.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ossa.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ossa.target.product');
              var select_menu = Y.DOM.byId('ossa.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ossa-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_remove_button": false, "header": "Select a project", "vocabulary_filters": [], "remove_team_text": "Remove team", "remove_person_text": "Remove person", "selected_value_metadata": null, "show_create_team": false, "picker_type": "default", "vocabulary_name": "Product", "extra_no_results_message": null, "selected_value": "ossa", "show_assign_me_button": false, "show_widget_id": "show-widget-ossa-target-product", "step_title": "Search", "assign_me_text": "Pick me", "input_element": "ossa.target.product"};
        var show_widget_id = 'show-widget-ossa-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ossa.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ossa.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ossa.status" name="ossa.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="ossa.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ossa.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="ossa.assignee.assign_to_nobody" name="ossa.assignee.option" value="ossa.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ossa.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ossa.assignee.assign_to_me" name="ossa.assignee.option" value="ossa.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ossa.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ossa.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ossa.comment_on_change" name="ossa.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/keystone/+bug/1872733/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/keystone/+bug/1872733/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/keystone/+bug/1872733/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>&quot;_build_<wbr />target_<wbr />enforcement&quot; function checks only for &quot;credential_id&quot;: <a rel="nofollow" href="https://github.com/openstack/keystone/blob/7bb6314e40d6947294260324e84a58de191f8609/keystone/api/credentials.py#L38">https:/<wbr />/github.<wbr />com/openstack/<wbr />keystone/<wbr />blob/7bb6314e40<wbr />d6947294260324e<wbr />84a58de191f8609<wbr />/keystone/<wbr />api/credentials<wbr />.py#L38</a></p>
<p>Thus even having a &#x27;&quot;identity:<wbr />update_<wbr />credential&quot;<wbr />: &quot;rule:cloud_admin or (user_id:<wbr />%(target.<wbr />credential.<wbr />user_id)<wbr />s)&quot;&#x27; policy doesn&#x27;t prevent a malicious user to create an EC2 credential, then change its owner and project ID, e.g.:</p>
<p>curl -X PATCH <a rel="nofollow" href="https://keystone/v3/credentials/3c2b3265350c6da3a18a143fbe975ca4a8ed88a6f8c6dacc2494a5c1287ba66f">https:/<wbr />/keystone/<wbr />v3/credentials/<wbr />3c2b3265350c6da<wbr />3a18a143fbe975c<wbr />a4a8ed88a6f8c6d<wbr />acc2494a5c1287b<wbr />a66f</a> -H &#x27;Accept: application/json&#x27; -H &#x27;Content-Type: application/json&#x27; -H &quot;X-Auth-Token: ***&quot; -d&#x27;{<br />
&nbsp;&nbsp;&quot;credential&quot;: {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;project_id&quot;: &quot;_target_<wbr />project_<wbr />id_&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;user_id&quot;: &quot;_target_user_id_&quot;<br />
&nbsp;&nbsp;}<br />
}&#x27;</p>
<p>Additionally it is possible to Create a credential with any existing project_id, though it doesn&#x27;t have a serious security issue, e.g.:</p>
<p>{<br />
&nbsp;&nbsp;&quot;credential&quot;: {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;blob&quot;: &quot;{\&quot;access\&quot;: \&quot;ffe6fc21b47c4<wbr />d87befc95ad070c<wbr />3b7a\&quot;, \&quot;secret\&quot;: \&quot;530196cd097e4<wbr />a7ca9df7258aa89<wbr />ff0e\&quot;, \&quot;trust_id\&quot;: null}&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;id&quot;: &quot;3c2b3265350c6d<wbr />a3a18a143fbe975<wbr />ca4a8ed88a6f8c6<wbr />dacc2494a5c1287<wbr />ba66f&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;project_id&quot;: &quot;_any_project_id_&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;ec2&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;user_id&quot;: &quot;_my_user_id_&quot;<br />
&nbsp;&nbsp;}<br />
}</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          <span>See <a href="comments/0">original description</a></span>
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            Tags:
          </span>
          <span id="tag-list">
            <a class="unofficial-tag" href="/keystone/+bugs?field.tag=in-stable-pike">in-stable-pike</a>
            <a class="unofficial-tag" href="/keystone/+bugs?field.tag=in-stable-queens">in-stable-queens</a>
            <a class="unofficial-tag" href="/keystone/+bugs?field.tag=in-stable-rocky">in-stable-rocky</a>
            <a class="unofficial-tag" href="/keystone/+bugs?field.tag=in-stable-stein">in-stable-stein</a>
            <a class="unofficial-tag" href="/keystone/+bugs?field.tag=in-stable-train">in-stable-train</a>
            <a class="unofficial-tag" href="/keystone/+bugs?field.tag=in-stable-ussuri">in-stable-ussuri</a>
          </span>
          
          <a href="+edit" title="Edit tags" id="tags-trigger" class="sprite edit action-icon">Edit</a>
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2020-12691" title="An issue was discovered in OpenStack ...">2020-12691</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-14T15:05:17.580949+00:00" title="2020-04-14 15:05:17 UTC">on 2020-04-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Since this report concerns a possible security risk, an incomplete<br />
security advisory task has been added while the core security<br />
reviewers for the affected project or projects confirm the bug and<br />
discuss the scope of any vulnerability along with potential<br />
solutions.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Since this report concerns a possible security risk, an incomplete
security advisory task has been added while the core security
reviewers for the affected project or projects confirm the bug and
discuss the scope of any vulnerability along with potential
solutions.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Incomplete
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kay-diam" class="sprite person">kay (kay-diam)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-14T15:20:14.417050+00:00" title="2020-04-14 15:20:14 UTC">on 2020-04-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>In case, when &quot;/credentials&quot; endpoint is used to store a secret for TOTP (Time-based One-time Password), an attacker can set a TOTP secret for a victim user and it will be used to verify TOTP &quot;passcode&quot; along with all &quot;totp&quot; secrets, associated with a victim user.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">In case, when "/credentials" endpoint is used to store a secret for TOTP (Time-based One-time Password), an attacker can set a TOTP secret for a victim user and it will be used to verify TOTP "passcode" along with all "totp" secrets, associated with a victim user.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-14T22:01:37.621468+00:00" title="2020-04-14 22:01:37 UTC">on 2020-04-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Verified. This is a critical issue as it allows any authenticated user to escalate to admin privileges. However, it is mitigated somewhat by the fact that the attacker needs to know or guess the UUID of the admin user and admin project, or the UUIDs of the user and project they are trying to impersonate.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Verified. This is a critical issue as it allows any authenticated user to escalate to admin privileges. However, it is mitigated somewhat by the fact that the attacker needs to know or guess the UUID of the admin user and admin project, or the UUIDs of the user and project they are trying to impersonate.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Triaged
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; High
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T00:26:19.333478+00:00" title="2020-04-15 00:26:19 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5354247/+files/0001-Disable-altering-credential-owner-attributes.patch">0001-Disable-altering-credential-owner-attributes.patch</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1872733/+attachment/5354247">Edit</a>
        (4.9 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Patch attached. Currently running tempest and unit tests on it locally.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Patch attached. Currently running tempest and unit tests on it locally.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Colleen Murphy (krinkle)
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Triaged &#8594; In Progress
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lbragstad" class="sprite person">Lance Bragstad (lbragstad)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T00:45:04.583970+00:00" title="2020-04-15 00:45:04 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The proposed patch in comment #4 looks good and the unit test covers the exposed behavior.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The proposed patch in comment #4 looks good and the unit test covers the exposed behavior.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T00:49:28.158575+00:00" title="2020-04-15 00:49:28 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks cmurphy for the quick fix, looks good and works for me locally.</p>
<p>With the verification here and fix, this is looking like a Class A vulnerability according to the VMT taxonomy[0]. Even with the requirement to know/guess UUIDs, this looks to be something that is exploitable by any authenticated user.</p>
<p>[0] <a rel="nofollow" href="https://security.openstack.org/vmt-process.html#incident-report-taxonomy">https:/<wbr />/security.<wbr />openstack.<wbr />org/vmt-<wbr />process.<wbr />html#incident-<wbr />report-<wbr />taxonomy</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks cmurphy for the quick fix, looks good and works for me locally.

With the verification here and fix, this is looking like a Class A vulnerability according to the VMT taxonomy[0]. Even with the requirement to know/guess UUIDs, this looks to be something that is exploitable by any authenticated user.

[0] https://security.openstack.org/vmt-process.html#incident-report-taxonomy</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~knikolla" class="sprite person">Kristi Nikolla (knikolla)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T00:58:24.226467+00:00" title="2020-04-15 00:58:24 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Patch in #4 looks good and unit test covers the issue. Was able to reproduce the bug local.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Patch in #4 looks good and unit test covers the issue. Was able to reproduce the bug local.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T04:44:16.616480+00:00" title="2020-04-15 04:44:16 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Tempest and py37 unit tests pass for me locally. We will need to backport this to all supported releases. I have backports prepared, but we should wait for the keystone stable/stein branch to be unblocked before proposing them[0].</p>
<p>[0] <a rel="nofollow" href="https://review.opendev.org/720053">https:/<wbr />/review.<wbr />opendev.<wbr />org/720053</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Tempest and py37 unit tests pass for me locally. We will need to backport this to all supported releases. I have backports prepared, but we should wait for the keystone stable/stein branch to be unblocked before proposing them[0].

[0] https://review.opendev.org/720053</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kay-diam" class="sprite person">kay (kay-diam)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T08:22:49.056119+00:00" title="2020-04-15 08:22:49 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi Colleen. Could you also add a protection and unit test for create action? It is not so serious, but would be great to have.</p>
<p>As I mentioned in original ticket it is possible to create EC2 credentials with any existing projectID, even if it is a domainID:</p>
<p>curl -X POST <a rel="nofollow" href="https://keystone/v3/credentials">https:/<wbr />/keystone/<wbr />v3/credentials</a> -H &#x27;Accept: application/json&#x27; -H &#x27;Content-Type: application/json&#x27; -H &quot;X-Auth-Token: ***&quot; -d&#x27;{<br />
&nbsp;&nbsp;&quot;credential&quot;: {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;blob&quot;: &quot;{\&quot;access\&quot;: \&quot;ffe6fc21b47c4<wbr />d87befc95ad070c<wbr />3b7a\&quot;, \&quot;secret\&quot;: \&quot;530196cd097e4<wbr />a7ca9df7258aa89<wbr />ff0e\&quot;, \&quot;trust_id\&quot;: null}&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;id&quot;: &quot;3c2b3265350c6d<wbr />a3a18a143fbe975<wbr />ca4a8ed88a6f8c6<wbr />dacc2494a5c1287<wbr />ba66f&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;project_id&quot;: &quot;_any_project_id_&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;ec2&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;user_id&quot;: &quot;_my_user_id_&quot;<br />
&nbsp;&nbsp;}<br />
}&#x27;</p>
<p>This credential won&#x27;t be useful, but it would be great to have this protection.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi Colleen. Could you also add a protection and unit test for create action? It is not so serious, but would be great to have.

As I mentioned in original ticket it is possible to create EC2 credentials with any existing projectID, even if it is a domainID:

curl -X POST https://keystone/v3/credentials -H 'Accept: application/json' -H 'Content-Type: application/json' -H "X-Auth-Token: ***" -d'{
  "credential": {
    "blob": "{\"access\": \"ffe6fc21b47c4d87befc95ad070c3b7a\", \"secret\": \"530196cd097e4a7ca9df7258aa89ff0e\", \"trust_id\": null}",
    "id": "3c2b3265350c6da3a18a143fbe975ca4a8ed88a6f8c6dacc2494a5c1287ba66f",
    "project_id": "_any_project_id_",
    "type": "ec2",
    "user_id": "_my_user_id_"
  }
}'

This credential won't be useful, but it would be great to have this protection.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T16:55:29.659740+00:00" title="2020-04-15 16:55:29 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Protecting the POST case is more complicated because not all credential types use project_id and so the credentials policy only checks against the credential&#x27;s owner, not their scope. Since this behavior is longstanding and can&#x27;t be exploited to elevate the user&#x27;s privileges, I&#x27;m inclined not to fix it.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Protecting the POST case is more complicated because not all credential types use project_id and so the credentials policy only checks against the credential's owner, not their scope. Since this behavior is longstanding and can't be exploited to elevate the user's privileges, I'm inclined not to fix it.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T18:35:02.587478+00:00" title="2020-04-15 18:35:02 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Since exploiting this depends on the attacker obtaining a UUID to which they should not normally have access, the VMT would typically consider this a class C1 report:</p>
<p><a rel="nofollow" href="https://security.openstack.org/vmt-process.html#incident-report-taxonomy">https:/<wbr />/security.<wbr />openstack.<wbr />org/vmt-<wbr />process.<wbr />html#incident-<wbr />report-<wbr />taxonomy</a></p>
<p>As such, it shouldn&#x27;t warrant the overhead of an embargo process and would be fine finishing in public instead. Does anyone disagree with that assessment?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Since exploiting this depends on the attacker obtaining a UUID to which they should not normally have access, the VMT would typically consider this a class C1 report:

https://security.openstack.org/vmt-process.html#incident-report-taxonomy

As such, it shouldn't warrant the overhead of an embargo process and would be fine finishing in public instead. Does anyone disagree with that assessment?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T18:39:37.224305+00:00" title="2020-04-15 18:39:37 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Oh, now I see Gage&#x27;s suggestion to treat it as a class A report instead. Gage, what&#x27;s the scenario where an authenticated user can exploit this without access to the victim&#x27;s UUID?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Oh, now I see Gage's suggestion to treat it as a class A report instead. Gage, what's the scenario where an authenticated user can exploit this without access to the victim's UUID?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T18:51:34.756312+00:00" title="2020-04-15 18:51:34 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I believe I was thinking that an authenticated user would be able to guess easier than a remote non-authenticated user.  I&#x27;m fine with classifying this as C1 since it really does depend on UUID guessing.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I believe I was thinking that an authenticated user would be able to guess easier than a remote non-authenticated user.  I'm fine with classifying this as C1 since it really does depend on UUID guessing.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kay-diam" class="sprite person">kay (kay-diam)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T19:06:50.606705+00:00" title="2020-04-15 19:06:50 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>In certain OpenStack environments user listing is allowed. As for the project IDs, users just post them in chats/github and don&#x27;t think it is a secret. I&#x27;d not call it &quot;guessing&quot;.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">In certain OpenStack environments user listing is allowed. As for the project IDs, users just post them in chats/github and don't think it is a secret. I'd not call it "guessing".</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/15" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T19:27:14.189956+00:00" title="2020-04-15 19:27:14 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/15"> #15</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Resource UUIDs are often not as carefully protected as other secret information. We have already set a precedent[0] that UUIDs are effectively public.</p>
<p>[0] <a rel="nofollow" href="https://bugs.launchpad.net/keystone/+bug/1840288">https:/<wbr />/bugs.launchpad<wbr />.net/keystone/<wbr />+bug/1840288</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Resource UUIDs are often not as carefully protected as other secret information. We have already set a precedent[0] that UUIDs are effectively public.

[0] https://bugs.launchpad.net/keystone/+bug/1840288 </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/16" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~knikolla" class="sprite person">Kristi Nikolla (knikolla)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T20:08:35.446949+00:00" title="2020-04-15 20:08:35 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/16"> #16</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>In our environment, we allow users with project_admin role to list people in their project. If a user with an admin role is part of the project of a malicious user (maybe to help with some debugging, or an inherited role), this would allow the malicious user to know the UUID of the admin user.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">In our environment, we allow users with project_admin role to list people in their project. If a user with an admin role is part of the project of a malicious user (maybe to help with some debugging, or an inherited role), this would allow the malicious user to know the UUID of the admin user.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/17" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-15T21:32:26.051261+00:00" title="2020-04-15 21:32:26 UTC">on 2020-04-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/17"> #17</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Since it&#x27;s been suggested that account UUIDs are generally available to untrusted users in some environments, I concur that this is better handled as a class A report and continuing the embargo is unfortunately warranted.</p>
<p>The UUID guessing guidance was added as an example for the C1 report classification in 2015 via <a rel="nofollow" href="https://review.openstack.org/255476">https:/<wbr />/review.<wbr />openstack.<wbr />org/255476</a> following a rash of theoretical vulnerabilities in that vein, but several recent examples have made it clear that some of objects in various services&#x27; APIs are keyed with UUIDs which are not safeguarded or we otherwise don&#x27;t position this information as sensitive in obvious ways. As such, I&#x27;ve proposed <a rel="nofollow" href="https://review.opendev.org/720291">https:/<wbr />/review.<wbr />opendev.<wbr />org/720291</a> to remove this example from the OpenStack VMT&#x27;s report taxonomy.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Since it's been suggested that account UUIDs are generally available to untrusted users in some environments, I concur that this is better handled as a class A report and continuing the embargo is unfortunately warranted.

The UUID guessing guidance was added as an example for the C1 report classification in 2015 via https://review.openstack.org/255476 following a rash of theoretical vulnerabilities in that vein, but several recent examples have made it clear that some of objects in various services' APIs are keyed with UUIDs which are not safeguarded or we otherwise don't position this information as sensitive in obvious ways. As such, I've proposed https://review.opendev.org/720291 to remove this example from the OpenStack VMT's report taxonomy.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/18" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kay-diam" class="sprite person">kay (kay-diam)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-16T07:53:11.289794+00:00" title="2020-04-16 07:53:11 UTC">on 2020-04-16</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/18"> #18</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>There are at least two use cases, when project admin user or barbican secret owner needs to know user ID (in certain cases they are provisioned automatically, e.g. by LDAP):<br />
* assign a project role to this user, so he can access the project: <a rel="nofollow" href="https://docs.openstack.org/api-ref/identity/v3/?expanded=assign-role-to-user-on-project-detail#assign-role-to-user-on-project*">https:/<wbr />/docs.openstack<wbr />.org/api-<wbr />ref/identity/<wbr />v3/?expanded=<wbr />assign-<wbr />role-to-<wbr />user-on-<wbr />project-<wbr />detail#<wbr />assign-<wbr />role-to-<wbr />user-on-<wbr />project*</a> fine grained barbican ACL permissions: <a rel="nofollow" href="https://docs.openstack.org/barbican/latest/api/reference/acls.html">https:/<wbr />/docs.openstack<wbr />.org/barbican/<wbr />latest/<wbr />api/reference/<wbr />acls.html</a></p>
<p>Therefore it is not clear, whether user IDs or project IDs have to be considered as sensitive.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">There are at least two use cases, when project admin user or barbican secret owner needs to know user ID (in certain cases they are provisioned automatically, e.g. by LDAP):
* assign a project role to this user, so he can access the project: https://docs.openstack.org/api-ref/identity/v3/?expanded=assign-role-to-user-on-project-detail#assign-role-to-user-on-project* fine grained barbican ACL permissions: https://docs.openstack.org/barbican/latest/api/reference/acls.html

Therefore it is not clear, whether user IDs or project IDs have to be considered as sensitive.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/19" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-16T19:49:26.606724+00:00" title="2020-04-16 19:49:26 UTC">on 2020-04-16</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/19"> #19</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5355724/+files/0001-Disable-altering-credential-owner-attributes.patch">0001-Disable-altering-credential-owner-attributes.patch</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1872733/+attachment/5355724">Edit</a>
        (5.1 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Updated release notes in patch to include bug reference</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Updated release notes in patch to include bug reference</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/20" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-27T16:49:27.556393+00:00" title="2020-04-27 16:49:27 UTC">on 2020-04-27</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/20"> #20</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Is a CVE being requested for this? How can we move this forward?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Is a CVE being requested for this? How can we move this forward?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/21" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-27T17:00:05.989089+00:00" title="2020-04-27 17:00:05 UTC">on 2020-04-27</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/21"> #21</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>If we agree that this should be considered a Class A, I can write up an impact description for this.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">If we agree that this should be considered a Class A, I can write up an impact description for this.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/22" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-27T17:13:52.392004+00:00" title="2020-04-27 17:13:52 UTC">on 2020-04-27</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/22"> #22</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>First draft below, please review:</p>
<p>Assuming that this affects all currently maintained releases of keystone.</p>
<p>Title: Credentials endpoint policy logic allows changing credential owner and target project ID<br />
Reporter: kay<br />
Products: Keystone<br />
Affects: &lt;15.0.1, ==16.0.0</p>
<p>Description:<br />
kay reported a vulnerability in Keystone&#x27;s EC2 credentials API. Any authenticated user could create an EC2 credential for themselves for a project that they have a specified role on, then perform an update to the credential user and project, allowing them to masquerade as another user. This potentially allows the malicious user to act as the admin on a project another user has the admin role on.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">First draft below, please review:

Assuming that this affects all currently maintained releases of keystone.

Title: Credentials endpoint policy logic allows changing credential owner and target project ID
Reporter: kay
Products: Keystone
Affects: &lt;15.0.1, ==16.0.0

Description:
kay reported a vulnerability in Keystone's EC2 credentials API. Any authenticated user could create an EC2 credential for themselves for a project that they have a specified role on, then perform an update to the credential user and project, allowing them to masquerade as another user. This potentially allows the malicious user to act as the admin on a project another user has the admin role on.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/23" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-27T17:25:52.175656+00:00" title="2020-04-27 17:25:52 UTC">on 2020-04-27</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/23"> #23</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><span class="foldable-quoted">&gt; This potentially allows the malicious user to act as the admin on a project another user has the admin role on
</span></p>
<p>... which in many cases can effectively grant the user global admin privileges.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">&gt; This potentially allows the malicious user to act as the admin on a project another user has the admin role on

... which in many cases can effectively grant the user global admin privileges.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/24" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-27T18:52:15.060680+00:00" title="2020-04-27 18:52:15 UTC">on 2020-04-27</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/24"> #24</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Updated, please review:</p>
<p>Title: Credentials endpoint policy logic allows changing credential owner and target project ID<br />
Reporter: kay<br />
Products: Keystone<br />
Affects: &lt;15.0.1, ==16.0.0</p>
<p>Description:<br />
kay reported a vulnerability in Keystone&#x27;s EC2 credentials API. Any authenticated user could create an EC2 credential for themselves for a project that they have a specified role on, then perform an update to the credential user and project, allowing them to masquerade as another user. This potentially allows the malicious user to act as the admin on a project another user has the admin role on, which can effectively grant the user global admin privileges.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Updated, please review:

Title: Credentials endpoint policy logic allows changing credential owner and target project ID
Reporter: kay
Products: Keystone
Affects: &lt;15.0.1, ==16.0.0

Description:
kay reported a vulnerability in Keystone's EC2 credentials API. Any authenticated user could create an EC2 credential for themselves for a project that they have a specified role on, then perform an update to the credential user and project, allowing them to masquerade as another user. This potentially allows the malicious user to act as the admin on a project another user has the admin role on, which can effectively grant the user global admin privileges.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/25" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-27T19:09:15.138439+00:00" title="2020-04-27 19:09:15 UTC">on 2020-04-27</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/25"> #25</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>lgtm</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">lgtm</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/26" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-27T19:53:45.069742+00:00" title="2020-04-27 19:53:45 UTC">on 2020-04-27</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/26"> #26</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Gage&#x27;s impact description in comment #24 works for me, I think we&#x27;re set to get a CVE request rolling for this one and propose a disclosure timeline once the stable branch backports are confirmed viable.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Gage's impact description in comment #24 works for me, I think we're set to get a CVE request rolling for this one and propose a disclosure timeline once the stable branch backports are confirmed viable.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/27" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-30T03:38:54.659517+00:00" title="2020-04-30 03:38:54 UTC">on 2020-04-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/27"> #27</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Could we get a patch for Stein/Train for this as well?</p>
<p>Waiting on a response for the CVE.</p>
<p>I&#x27;d like to propose next Tuesday (May 5th) as the proper disclosure date as well for this. Does that sound reasonable?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Could we get a patch for Stein/Train for this as well?

Waiting on a response for the CVE.

I'd like to propose next Tuesday (May 5th) as the proper disclosure date as well for this. Does that sound reasonable?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/28" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-30T04:02:35.405218+00:00" title="2020-04-30 04:02:35 UTC">on 2020-04-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/28"> #28</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5363821/+files/0001-Disable-altering-credential-owner-attributes.patch-train">train</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1872733/+attachment/5363821">Edit</a>
        (5.2 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/29" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-30T04:03:14.273817+00:00" title="2020-04-30 04:03:14 UTC">on 2020-04-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/29"> #29</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5363822/+files/0001-Disable-altering-credential-owner-attributes.patch-stein">0001-Disable-altering-credential-owner-attributes.patch-stein</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1872733/+attachment/5363822">Edit</a>
        (5.2 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/30" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-30T21:18:37.867678+00:00" title="2020-04-30 21:18:37 UTC">on 2020-04-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/30"> #30</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>May 5 disclosure should work as long as we send a downstream stakeholder notification with the patches for this no later than tomorrow (Friday, May 1).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">May 5 disclosure should work as long as we send a downstream stakeholder notification with the patches for this no later than tomorrow (Friday, May 1).</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/31" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-01T15:15:04.835938+00:00" title="2020-05-01 15:15:04 UTC">on 2020-05-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/31"> #31</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>In retrospect, what with the tight timeline and this being a major holiday weekend for much of the World, let&#x27;s push the advisory date to Wednesday May 6.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">In retrospect, what with the tight timeline and this being a major holiday weekend for much of the World, let's push the advisory date to Wednesday May 6.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/32" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-01T16:00:54.740965+00:00" title="2020-05-01 16:00:54 UTC">on 2020-05-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/32"> #32</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>May 6th works, we will still send out the embargo notification today.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">May 6th works, we will still send out the embargo notification today.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/33" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-01T16:49:44.442131+00:00" title="2020-05-01 16:49:44 UTC">on 2020-05-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/33"> #33</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Embargo email sent.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Embargo email sent.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/34" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~nickthetait" class="sprite person">Nick Tait (nickthetait)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-01T23:24:22.871317+00:00" title="2020-05-01 23:24:22 UTC">on 2020-05-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/34"> #34</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I support Class A for this. Eagerly awaiting CVE assignment. Simplified the description a little, you are welcome to use this:</p>
<p>kay reported a vulnerability in Keystone&#x27;s EC2 credentials API. Any authenticated user could create an EC2 credential in a project that they have a specified role on, then modify the credential user and project, allowing them to masquerade as another user. This may enable a malicious user to escalate themselves as an admin which (in some environments) is equivalent to gaining global admin privileges.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I support Class A for this. Eagerly awaiting CVE assignment. Simplified the description a little, you are welcome to use this:

kay reported a vulnerability in Keystone's EC2 credentials API. Any authenticated user could create an EC2 credential in a project that they have a specified role on, then modify the credential user and project, allowing them to masquerade as another user. This may enable a malicious user to escalate themselves as an admin which (in some environments) is equivalent to gaining global admin privileges.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/35" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~krinkle" class="sprite person">Colleen Murphy (krinkle)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-04T05:03:19.516740+00:00" title="2020-05-04 05:03:19 UTC">on 2020-05-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/35"> #35</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5365987/+files/bug-1872733.diff">bug-1872733.diff</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1872733/+attachment/5365987">Edit</a>
        (660 bytes,
        text/plain)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve reworked this patch to include fixes for <a href="/bugs/1872733" class="bug-link">bug 1872733</a>, <a href="/bugs/1872735" class="bug-link">bug 1872735</a> and <a href="/bugs/1872755" class="bug-link">bug 1872755</a> and to resolve the merge conflict arising from the fix for <a href="/bugs/1872737" class="bug-link">bug 1872737</a>. These patches are independently appliable but they won&#x27;t pass unit tests without also applying the fix for 1873290. I&#x27;ve attached them on <a href="/bugs/1872735" class="bug-link">bug 1872735</a>.</p>
<p>In validating the new version I noticed an error in the solution for this bug, attaching the diff here.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've reworked this patch to include fixes for bug 1872733, bug 1872735 and bug 1872755 and to resolve the merge conflict arising from the fix for bug 1872737. These patches are independently appliable but they won't pass unit tests without also applying the fix for 1873290. I've attached them on bug 1872735.

In validating the new version I noticed an error in the solution for this bug, attaching the diff here.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/36" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-06T15:10:52.895590+00:00" title="2020-05-06 15:10:52 UTC">on 2020-05-06</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/36"> #36</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The embargo for this bug has expired, we will be making public and fixes will be available in gerrit here shortly.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The embargo for this bug has expired, we will be making public and fixes will be available in gerrit here shortly.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/37" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-06T15:16:11.363990+00:00" title="2020-05-06 15:16:11 UTC">on 2020-05-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/37">
                <strong>Fix proposed to keystone (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/37"> #37</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.opendev.org/725886">https:/<wbr />/review.<wbr />opendev.<wbr />org/725886</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: master
Review: https://review.opendev.org/725886</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/38" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-06T15:17:04.334294+00:00" title="2020-05-06 15:17:04 UTC">on 2020-05-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/38">
                <strong>Fix proposed to keystone (stable/ussuri)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/38"> #38</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/ussuri<br />
Review: <a rel="nofollow" href="https://review.opendev.org/725888">https:/<wbr />/review.<wbr />opendev.<wbr />org/725888</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/725888</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/39" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-06T15:18:10.234089+00:00" title="2020-05-06 15:18:10 UTC">on 2020-05-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/39">
                <strong>Fix proposed to keystone (stable/train)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/39"> #39</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/train<br />
Review: <a rel="nofollow" href="https://review.opendev.org/725891">https:/<wbr />/review.<wbr />opendev.<wbr />org/725891</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/train
Review: https://review.opendev.org/725891</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/40" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-06T15:19:00.501919+00:00" title="2020-05-06 15:19:00 UTC">on 2020-05-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/40">
                <strong>Fix proposed to keystone (stable/stein)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/40"> #40</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/stein<br />
Review: <a rel="nofollow" href="https://review.opendev.org/725893">https:/<wbr />/review.<wbr />opendev.<wbr />org/725893</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/stein
Review: https://review.opendev.org/725893</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/41" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-06T15:20:31.126804+00:00" title="2020-05-06 15:20:31 UTC">on 2020-05-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/41">
                <strong>Fix proposed to keystone (stable/rocky)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/41"> #41</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/rocky<br />
Review: <a rel="nofollow" href="https://review.opendev.org/725895">https:/<wbr />/review.<wbr />opendev.<wbr />org/725895</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/rocky
Review: https://review.opendev.org/725895</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2020-05-06 18:04:50 UTC" datetime="2020-05-06T18:04:50.200898+00:00">on 2020-05-06</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Incomplete &#8594; In Progress
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/42" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-06T18:57:41.192504+00:00" title="2020-05-06 18:57:41 UTC">on 2020-05-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/42">
                <strong>Fix merged to ossa (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/42"> #42</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/725912">https:/<wbr />/review.<wbr />opendev.<wbr />org/725912</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/ossa/commit/?id=2548f46b0aff357f6c953b30179b4d8e151e4236">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />ossa/commit/<wbr />?id=2548f46b0af<wbr />f357f6c953b3017<wbr />9b4d8e151e4236</a><br />
Submitter: Zuul<br />
Branch:    master</p>
<p>commit 2548f46b0aff357<wbr />f6c953b30179b4d<wbr />8e151e4236<br />
Author: Gage Hugo &lt;email address hidden&gt;<br />
Date:   Wed May 6 10:57:15 2020 -0500</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Add OSSA-2020-004 (CVEs Pending)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ide28e91b184eda<wbr />b45d22c47661ad6<wbr />bb6003dd244<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #1872735<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #1872733</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/725912
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=2548f46b0aff357f6c953b30179b4d8e151e4236
Submitter: Zuul
Branch:    master

commit 2548f46b0aff357f6c953b30179b4d8e151e4236
Author: Gage Hugo &lt;gagehugo@gmail.com&gt;
Date:   Wed May 6 10:57:15 2020 -0500

    Add OSSA-2020-004 (CVEs Pending)
    
    Change-Id: Ide28e91b184edab45d22c47661ad6bb6003dd244
    Closes-Bug: #1872735
    Closes-Bug: #1872733
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/43" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-07T06:32:49.853610+00:00" title="2020-05-07 06:32:49 UTC">on 2020-05-07</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/43">
                <strong>Fix proposed to keystone (stable/pike)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/43"> #43</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/pike<br />
Review: <a rel="nofollow" href="https://review.opendev.org/726046">https:/<wbr />/review.<wbr />opendev.<wbr />org/726046</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/pike
Review: https://review.opendev.org/726046</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~gagehugo" class="sprite person">Gage Hugo (gagehugo)</a>
    
    <time title="2020-05-07 18:42:37 UTC" datetime="2020-05-07T18:42:37.311130+00:00">on 2020-05-07</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - Keystone V3 /credentials endpoint policy logic allows to change<br />- credentials owner or target project ID<br />+ [OSSA-2020-004] Keystone V3 /credentials endpoint policy logic allows to<br />+ change credentials owner or target project ID (CVE-2020-12691)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/44" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-07T19:53:03.255461+00:00" title="2020-05-07 19:53:03 UTC">on 2020-05-07</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/44">
                <strong>Fix merged to keystone (stable/ussuri)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/44"> #44</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/725888">https:/<wbr />/review.<wbr />opendev.<wbr />org/725888</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=2f2736ebb267c757ad77fcf25ee0aaeefab2a09d">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=2f2736ebb26<wbr />7c757ad77fcf25e<wbr />e0aaeefab2a09d</a><br />
Submitter: Zuul<br />
Branch:    stable/ussuri</p>
<p>commit 2f2736ebb267c75<wbr />7ad77fcf25ee0aa<wbr />eefab2a09d<br />
Author: Colleen Murphy &lt;email address hidden&gt;<br />
Date:   Tue Apr 14 16:47:44 2020 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix security issues with EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change addresses several issues in the creation and use of EC2/S3<br />
&nbsp;&nbsp;&nbsp;&nbsp;credentials with keystone tokens.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1. Disable altering credential owner attributes or metadata</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, an authenticated user can create an EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;for themself for a project they have a role on, then update the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential to target a user and project completely unrelated to them. In<br />
&nbsp;&nbsp;&nbsp;&nbsp;the worst case, this could be the admin user and a project the admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user has a role assignment on. A token granted for an altered credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;like this would allow the user to masquerade as the victim user. This<br />
&nbsp;&nbsp;&nbsp;&nbsp;patch ensures that when updating a credential, the new form of the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential is one the acting user has access to: if the system admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user is changing the credential, the new user ID or project ID could be<br />
&nbsp;&nbsp;&nbsp;&nbsp;anything, but regular users may only change the credential to be one<br />
&nbsp;&nbsp;&nbsp;&nbsp;that they still own.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Relatedly, when a user uses an application credential or a trust to<br />
&nbsp;&nbsp;&nbsp;&nbsp;create an EC2 credential, keystone automatically adds the trust ID or<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential ID as metadata in the EC2 access blob so that it<br />
&nbsp;&nbsp;&nbsp;&nbsp;knows how the token can be scoped when it is used. Without this patch, a<br />
&nbsp;&nbsp;&nbsp;&nbsp;user who has created a credential in this way can update the access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;to remove or alter this metadata and escalate their privileges to be<br />
&nbsp;&nbsp;&nbsp;&nbsp;fully authorized for the trustor&#x27;s, application credential creator&#x27;s, or<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token authorizor&#x27;s privileges on the project. This patch<br />
&nbsp;&nbsp;&nbsp;&nbsp;fixes the issue by simply disallowing updates to keystone-controlled<br />
&nbsp;&nbsp;&nbsp;&nbsp;metadata in the credential.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2. Respect token roles when creating EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, a trustee, an application credential user, or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token holder could create an EC2 credential or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential using any roles the trustor, application<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential creator, or access token authorizor had on the project,<br />
&nbsp;&nbsp;&nbsp;&nbsp;regardless of whether the creator had delegated only a limited subset of<br />
&nbsp;&nbsp;&nbsp;&nbsp;roles. This was because the trust_id attribute of the EC2 access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;was ignored, and no metadata for the application credential or access<br />
&nbsp;&nbsp;&nbsp;&nbsp;token was recorded either. This change ensures that the access<br />
&nbsp;&nbsp;&nbsp;&nbsp;delegation resource is recorded in the metadata of the EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;when created and passed to the token provider when used for<br />
&nbsp;&nbsp;&nbsp;&nbsp;authentication so that the token provider can look up the correct roles<br />
&nbsp;&nbsp;&nbsp;&nbsp;for the request.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I39d0d705839fbe<wbr />31ac518ac9a8295<wbr />9e108cb7c1d<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1872733<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1872755<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1872735<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 37e9907a176dad6<wbr />843819b1bec4946<wbr />c3aecc4548)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/725888
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=2f2736ebb267c757ad77fcf25ee0aaeefab2a09d
Submitter: Zuul
Branch:    stable/ussuri

commit 2f2736ebb267c757ad77fcf25ee0aaeefab2a09d
Author: Colleen Murphy &lt;colleen.murphy@suse.com&gt;
Date:   Tue Apr 14 16:47:44 2020 -0700

    Fix security issues with EC2 credentials
    
    This change addresses several issues in the creation and use of EC2/S3
    credentials with keystone tokens.
    
    1. Disable altering credential owner attributes or metadata
    
    Without this patch, an authenticated user can create an EC2 credential
    for themself for a project they have a role on, then update the
    credential to target a user and project completely unrelated to them. In
    the worst case, this could be the admin user and a project the admin
    user has a role assignment on. A token granted for an altered credential
    like this would allow the user to masquerade as the victim user. This
    patch ensures that when updating a credential, the new form of the
    credential is one the acting user has access to: if the system admin
    user is changing the credential, the new user ID or project ID could be
    anything, but regular users may only change the credential to be one
    that they still own.
    
    Relatedly, when a user uses an application credential or a trust to
    create an EC2 credential, keystone automatically adds the trust ID or
    application credential ID as metadata in the EC2 access blob so that it
    knows how the token can be scoped when it is used. Without this patch, a
    user who has created a credential in this way can update the access blob
    to remove or alter this metadata and escalate their privileges to be
    fully authorized for the trustor's, application credential creator's, or
    OAuth1 access token authorizor's privileges on the project. This patch
    fixes the issue by simply disallowing updates to keystone-controlled
    metadata in the credential.
    
    2. Respect token roles when creating EC2 credentials
    
    Without this patch, a trustee, an application credential user, or an
    OAuth1 access token holder could create an EC2 credential or an
    application credential using any roles the trustor, application
    credential creator, or access token authorizor had on the project,
    regardless of whether the creator had delegated only a limited subset of
    roles. This was because the trust_id attribute of the EC2 access blob
    was ignored, and no metadata for the application credential or access
    token was recorded either. This change ensures that the access
    delegation resource is recorded in the metadata of the EC2 credential
    when created and passed to the token provider when used for
    authentication so that the token provider can look up the correct roles
    for the request.
    
    Change-Id: I39d0d705839fbe31ac518ac9a82959e108cb7c1d
    Closes-bug: #1872733
    Closes-bug: #1872755
    Closes-bug: #1872735
    (cherry picked from commit 37e9907a176dad6843819b1bec4946c3aecc4548)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-ussuri
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/45" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-08T16:14:57.332811+00:00" title="2020-05-08 16:14:57 UTC">on 2020-05-08</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/45">
                <strong>Fix merged to keystone (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/45"> #45</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/725886">https:/<wbr />/review.<wbr />opendev.<wbr />org/725886</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=37e9907a176dad6843819b1bec4946c3aecc4548">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=37e9907a176<wbr />dad6843819b1bec<wbr />4946c3aecc4548</a><br />
Submitter: Zuul<br />
Branch:    master</p>
<p>commit 37e9907a176dad6<wbr />843819b1bec4946<wbr />c3aecc4548<br />
Author: Colleen Murphy &lt;email address hidden&gt;<br />
Date:   Tue Apr 14 16:47:44 2020 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix security issues with EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change addresses several issues in the creation and use of EC2/S3<br />
&nbsp;&nbsp;&nbsp;&nbsp;credentials with keystone tokens.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1. Disable altering credential owner attributes or metadata</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, an authenticated user can create an EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;for themself for a project they have a role on, then update the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential to target a user and project completely unrelated to them. In<br />
&nbsp;&nbsp;&nbsp;&nbsp;the worst case, this could be the admin user and a project the admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user has a role assignment on. A token granted for an altered credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;like this would allow the user to masquerade as the victim user. This<br />
&nbsp;&nbsp;&nbsp;&nbsp;patch ensures that when updating a credential, the new form of the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential is one the acting user has access to: if the system admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user is changing the credential, the new user ID or project ID could be<br />
&nbsp;&nbsp;&nbsp;&nbsp;anything, but regular users may only change the credential to be one<br />
&nbsp;&nbsp;&nbsp;&nbsp;that they still own.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Relatedly, when a user uses an application credential or a trust to<br />
&nbsp;&nbsp;&nbsp;&nbsp;create an EC2 credential, keystone automatically adds the trust ID or<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential ID as metadata in the EC2 access blob so that it<br />
&nbsp;&nbsp;&nbsp;&nbsp;knows how the token can be scoped when it is used. Without this patch, a<br />
&nbsp;&nbsp;&nbsp;&nbsp;user who has created a credential in this way can update the access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;to remove or alter this metadata and escalate their privileges to be<br />
&nbsp;&nbsp;&nbsp;&nbsp;fully authorized for the trustor&#x27;s, application credential creator&#x27;s, or<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token authorizor&#x27;s privileges on the project. This patch<br />
&nbsp;&nbsp;&nbsp;&nbsp;fixes the issue by simply disallowing updates to keystone-controlled<br />
&nbsp;&nbsp;&nbsp;&nbsp;metadata in the credential.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2. Respect token roles when creating EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, a trustee, an application credential user, or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token holder could create an EC2 credential or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential using any roles the trustor, application<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential creator, or access token authorizor had on the project,<br />
&nbsp;&nbsp;&nbsp;&nbsp;regardless of whether the creator had delegated only a limited subset of<br />
&nbsp;&nbsp;&nbsp;&nbsp;roles. This was because the trust_id attribute of the EC2 access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;was ignored, and no metadata for the application credential or access<br />
&nbsp;&nbsp;&nbsp;&nbsp;token was recorded either. This change ensures that the access<br />
&nbsp;&nbsp;&nbsp;&nbsp;delegation resource is recorded in the metadata of the EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;when created and passed to the token provider when used for<br />
&nbsp;&nbsp;&nbsp;&nbsp;authentication so that the token provider can look up the correct roles<br />
&nbsp;&nbsp;&nbsp;&nbsp;for the request.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I39d0d705839fbe<wbr />31ac518ac9a8295<wbr />9e108cb7c1d<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1872733<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1872755<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1872735</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/725886
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=37e9907a176dad6843819b1bec4946c3aecc4548
Submitter: Zuul
Branch:    master

commit 37e9907a176dad6843819b1bec4946c3aecc4548
Author: Colleen Murphy &lt;colleen.murphy@suse.com&gt;
Date:   Tue Apr 14 16:47:44 2020 -0700

    Fix security issues with EC2 credentials
    
    This change addresses several issues in the creation and use of EC2/S3
    credentials with keystone tokens.
    
    1. Disable altering credential owner attributes or metadata
    
    Without this patch, an authenticated user can create an EC2 credential
    for themself for a project they have a role on, then update the
    credential to target a user and project completely unrelated to them. In
    the worst case, this could be the admin user and a project the admin
    user has a role assignment on. A token granted for an altered credential
    like this would allow the user to masquerade as the victim user. This
    patch ensures that when updating a credential, the new form of the
    credential is one the acting user has access to: if the system admin
    user is changing the credential, the new user ID or project ID could be
    anything, but regular users may only change the credential to be one
    that they still own.
    
    Relatedly, when a user uses an application credential or a trust to
    create an EC2 credential, keystone automatically adds the trust ID or
    application credential ID as metadata in the EC2 access blob so that it
    knows how the token can be scoped when it is used. Without this patch, a
    user who has created a credential in this way can update the access blob
    to remove or alter this metadata and escalate their privileges to be
    fully authorized for the trustor's, application credential creator's, or
    OAuth1 access token authorizor's privileges on the project. This patch
    fixes the issue by simply disallowing updates to keystone-controlled
    metadata in the credential.
    
    2. Respect token roles when creating EC2 credentials
    
    Without this patch, a trustee, an application credential user, or an
    OAuth1 access token holder could create an EC2 credential or an
    application credential using any roles the trustor, application
    credential creator, or access token authorizor had on the project,
    regardless of whether the creator had delegated only a limited subset of
    roles. This was because the trust_id attribute of the EC2 access blob
    was ignored, and no metadata for the application credential or access
    token was recorded either. This change ensures that the access
    delegation resource is recorded in the metadata of the EC2 credential
    when created and passed to the token provider when used for
    authentication so that the token provider can look up the correct roles
    for the request.
    
    Change-Id: I39d0d705839fbe31ac518ac9a82959e108cb7c1d
    Closes-bug: #1872733
    Closes-bug: #1872755
    Closes-bug: #1872735
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/46" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-08T16:22:56.046844+00:00" title="2020-05-08 16:22:56 UTC">on 2020-05-08</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/46">
                <strong>Fix proposed to keystone (stable/queens)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/46"> #46</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/queens<br />
Review: <a rel="nofollow" href="https://review.opendev.org/726435">https:/<wbr />/review.<wbr />opendev.<wbr />org/726435</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/queens
Review: https://review.opendev.org/726435</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/47" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-11T05:38:38.580469+00:00" title="2020-05-11 05:38:38 UTC">on 2020-05-11</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/47">
                <strong>Fix merged to keystone (stable/train)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/47"> #47</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/keystone/+bug/1872733/comments/47/+download">Download full text</a> (3.4 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/725891">https:/<wbr />/review.<wbr />opendev.<wbr />org/725891</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=54590544fb7a2cd65e23fce8abcf77296352cd29">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=54590544fb7<wbr />a2cd65e23fce8ab<wbr />cf77296352cd29</a><br />
Submitter: Zuul<br />
Branch:    stable/train</p>
<p>commit 54590544fb7a2cd<wbr />65e23fce8abcf77<wbr />296352cd29<br />
Author: Colleen Murphy &lt;email address hidden&gt;<br />
Date:   Tue Apr 14 16:47:44 2020 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix security issues with EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change addresses several issues in the creation and use of EC2/S3<br />
&nbsp;&nbsp;&nbsp;&nbsp;credentials with keystone tokens.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1. Disable altering credential owner attributes or metadata</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, an authenticated user can create an EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;for themself for a project they have a role on, then update the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential to target a user and project completely unrelated to them. In<br />
&nbsp;&nbsp;&nbsp;&nbsp;the worst case, this could be the admin user and a project the admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user has a role assignment on. A token granted for an altered credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;like this would allow the user to masquerade as the victim user. This<br />
&nbsp;&nbsp;&nbsp;&nbsp;patch ensures that when updating a credential, the new form of the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential is one the acting user has access to: if the system admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user is changing the credential, the new user ID or project ID could be<br />
&nbsp;&nbsp;&nbsp;&nbsp;anything, but regular users may only change the credential to be one<br />
&nbsp;&nbsp;&nbsp;&nbsp;that they still own.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Relatedly, when a user uses an application credential or a trust to<br />
&nbsp;&nbsp;&nbsp;&nbsp;create an EC2 credential, keystone automatically adds the trust ID or<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential ID as metadata in the EC2 access blob so that it<br />
&nbsp;&nbsp;&nbsp;&nbsp;knows how the token can be scoped when it is used. Without this patch, a<br />
&nbsp;&nbsp;&nbsp;&nbsp;user who has created a credential in this way can update the access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;to remove or alter this metadata and escalate their privileges to be<br />
&nbsp;&nbsp;&nbsp;&nbsp;fully authorized for the trustor&#x27;s, application credential creator&#x27;s, or<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token authorizor&#x27;s privileges on the project. This patch<br />
&nbsp;&nbsp;&nbsp;&nbsp;fixes the issue by simply disallowing updates to keystone-controlled<br />
&nbsp;&nbsp;&nbsp;&nbsp;metadata in the credential.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2. Respect token roles when creating EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, a trustee, an application credential user, or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token holder could create an EC2 credential or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential using any roles the trustor, application<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential creator, or access token authorizor had on the project,<br />
&nbsp;&nbsp;&nbsp;&nbsp;regardless of whether the creator had delegated only a limited subset of<br />
&nbsp;&nbsp;&nbsp;&nbsp;roles. This was because the trust_id attribute of the EC2 access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;was ignored, and no metadata for the application credential or access<br />
&nbsp;&nbsp;&nbsp;&nbsp;token was recorded either. This change ensures that the access<br />
&nbsp;&nbsp;&nbsp;&nbsp;delegation resource is recorded in the metadata of the EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;when created and passed to the token provider when used for<br />
&nbsp;&nbsp;&nbsp;&nbsp;authentication so that the token provider can look up the correct roles<br />
&nbsp;&nbsp;&nbsp;&nbsp;for the request.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9, test helper<br />
&nbsp;&nbsp;&nbsp;&nbsp;in 52da4d0e12):<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />api/credentials<wbr />.py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />application_<wbr />credential.<wbr />py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />credential.<wbr />py</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Depends-on: htt...</p></div>
    
    <p>
      <a href="/keystone/+bug/1872733/comments/47">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/725891
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=54590544fb7a2cd65e23fce8abcf77296352cd29
Submitter: Zuul
Branch:    stable/train

commit 54590544fb7a2cd65e23fce8abcf77296352cd29
Author: Colleen Murphy &lt;colleen.murphy@suse.com&gt;
Date:   Tue Apr 14 16:47:44 2020 -0700

    Fix security issues with EC2 credentials
    
    This change addresses several issues in the creation and use of EC2/S3
    credentials with keystone tokens.
    
    1. Disable altering credential owner attributes or metadata
    
    Without this patch, an authenticated user can create an EC2 credential
    for themself for a project they have a role on, then update the
    credential to target a user and project completely unrelated to them. In
    the worst case, this could be the admin user and a project the admin
    user has a role assignment on. A token granted for an altered credential
    like this would allow the user to masquerade as the victim user. This
    patch ensures that when updating a credential, the new form of the
    credential is one the acting user has access to: if the system admin
    user is changing the credential, the new user ID or project ID could be
    anything, but regular users may only change the credential to be one
    that they still own.
    
    Relatedly, when a user uses an application credential or a trust to
    create an EC2 credential, keystone automatically adds the trust ID or
    application credential ID as metadata in the EC2 access blob so that it
    knows how the token can be scoped when it is used. Without this patch, a
    user who has created a credential in this way can update the access blob
    to remove or alter this metadata and escalate their privileges to be
    fully authorized for the trustor's, application credential creator's, or
    OAuth1 access token authorizor's privileges on the project. This patch
    fixes the issue by simply disallowing updates to keystone-controlled
    metadata in the credential.
    
    2. Respect token roles when creating EC2 credentials
    
    Without this patch, a trustee, an application credential user, or an
    OAuth1 access token holder could create an EC2 credential or an
    application credential using any roles the trustor, application
    credential creator, or access token authorizor had on the project,
    regardless of whether the creator had delegated only a limited subset of
    roles. This was because the trust_id attribute of the EC2 access blob
    was ignored, and no metadata for the application credential or access
    token was recorded either. This change ensures that the access
    delegation resource is recorded in the metadata of the EC2 credential
    when created and passed to the token provider when used for
    authentication so that the token provider can look up the correct roles
    for the request.
    
    Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9, test helper
    in 52da4d0e12):
          keystone/api/credentials.py
          keystone/tests/unit/test_v3_application_credential.py
          keystone/tests/unit/test_v3_credential.py
    
    Depends-on: https://review.opendev.org/726526
    
    Change-Id: I39d0d705839fbe31ac518ac9a82959e108cb7c1d
    Closes-bug: #1872733
    Closes-bug: #1872755
    Closes-bug: #1872735
    (cherry picked from commit 37e9907a176dad6843819b1bec4946c3aecc4548)
    (cherry picked from commit 2f2736ebb267c757ad77fcf25ee0aaeefab2a09d)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-train
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/48" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-11T20:02:03.971626+00:00" title="2020-05-11 20:02:03 UTC">on 2020-05-11</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/48">
                <strong>Fix merged to keystone (stable/stein)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/48"> #48</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/keystone/+bug/1872733/comments/48/+download">Download full text</a> (3.4 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/725893">https:/<wbr />/review.<wbr />opendev.<wbr />org/725893</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=206392a40ce3da3d389e5e7ec721ada2737b84da">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=206392a40ce<wbr />3da3d389e5e7ec7<wbr />21ada2737b84da</a><br />
Submitter: Zuul<br />
Branch:    stable/stein</p>
<p>commit 206392a40ce3da3<wbr />d389e5e7ec721ad<wbr />a2737b84da<br />
Author: Colleen Murphy &lt;email address hidden&gt;<br />
Date:   Tue Apr 14 16:47:44 2020 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix security issues with EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change addresses several issues in the creation and use of EC2/S3<br />
&nbsp;&nbsp;&nbsp;&nbsp;credentials with keystone tokens.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1. Disable altering credential owner attributes or metadata</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, an authenticated user can create an EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;for themself for a project they have a role on, then update the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential to target a user and project completely unrelated to them. In<br />
&nbsp;&nbsp;&nbsp;&nbsp;the worst case, this could be the admin user and a project the admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user has a role assignment on. A token granted for an altered credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;like this would allow the user to masquerade as the victim user. This<br />
&nbsp;&nbsp;&nbsp;&nbsp;patch ensures that when updating a credential, the new form of the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential is one the acting user has access to: if the system admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user is changing the credential, the new user ID or project ID could be<br />
&nbsp;&nbsp;&nbsp;&nbsp;anything, but regular users may only change the credential to be one<br />
&nbsp;&nbsp;&nbsp;&nbsp;that they still own.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Relatedly, when a user uses an application credential or a trust to<br />
&nbsp;&nbsp;&nbsp;&nbsp;create an EC2 credential, keystone automatically adds the trust ID or<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential ID as metadata in the EC2 access blob so that it<br />
&nbsp;&nbsp;&nbsp;&nbsp;knows how the token can be scoped when it is used. Without this patch, a<br />
&nbsp;&nbsp;&nbsp;&nbsp;user who has created a credential in this way can update the access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;to remove or alter this metadata and escalate their privileges to be<br />
&nbsp;&nbsp;&nbsp;&nbsp;fully authorized for the trustor&#x27;s, application credential creator&#x27;s, or<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token authorizor&#x27;s privileges on the project. This patch<br />
&nbsp;&nbsp;&nbsp;&nbsp;fixes the issue by simply disallowing updates to keystone-controlled<br />
&nbsp;&nbsp;&nbsp;&nbsp;metadata in the credential.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2. Respect token roles when creating EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, a trustee, an application credential user, or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token holder could create an EC2 credential or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential using any roles the trustor, application<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential creator, or access token authorizor had on the project,<br />
&nbsp;&nbsp;&nbsp;&nbsp;regardless of whether the creator had delegated only a limited subset of<br />
&nbsp;&nbsp;&nbsp;&nbsp;roles. This was because the trust_id attribute of the EC2 access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;was ignored, and no metadata for the application credential or access<br />
&nbsp;&nbsp;&nbsp;&nbsp;token was recorded either. This change ensures that the access<br />
&nbsp;&nbsp;&nbsp;&nbsp;delegation resource is recorded in the metadata of the EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;when created and passed to the token provider when used for<br />
&nbsp;&nbsp;&nbsp;&nbsp;authentication so that the token provider can look up the correct roles<br />
&nbsp;&nbsp;&nbsp;&nbsp;for the request.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9):<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />api/credentials<wbr />.py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />application_<wbr />credential.<wbr />py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />credential.<wbr />py</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I39d0d705839fbe<wbr />31ac518ac9a8295<wbr />9e108..<wbr />.</p></div>
    
    <p>
      <a href="/keystone/+bug/1872733/comments/48">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/725893
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=206392a40ce3da3d389e5e7ec721ada2737b84da
Submitter: Zuul
Branch:    stable/stein

commit 206392a40ce3da3d389e5e7ec721ada2737b84da
Author: Colleen Murphy &lt;colleen.murphy@suse.com&gt;
Date:   Tue Apr 14 16:47:44 2020 -0700

    Fix security issues with EC2 credentials
    
    This change addresses several issues in the creation and use of EC2/S3
    credentials with keystone tokens.
    
    1. Disable altering credential owner attributes or metadata
    
    Without this patch, an authenticated user can create an EC2 credential
    for themself for a project they have a role on, then update the
    credential to target a user and project completely unrelated to them. In
    the worst case, this could be the admin user and a project the admin
    user has a role assignment on. A token granted for an altered credential
    like this would allow the user to masquerade as the victim user. This
    patch ensures that when updating a credential, the new form of the
    credential is one the acting user has access to: if the system admin
    user is changing the credential, the new user ID or project ID could be
    anything, but regular users may only change the credential to be one
    that they still own.
    
    Relatedly, when a user uses an application credential or a trust to
    create an EC2 credential, keystone automatically adds the trust ID or
    application credential ID as metadata in the EC2 access blob so that it
    knows how the token can be scoped when it is used. Without this patch, a
    user who has created a credential in this way can update the access blob
    to remove or alter this metadata and escalate their privileges to be
    fully authorized for the trustor's, application credential creator's, or
    OAuth1 access token authorizor's privileges on the project. This patch
    fixes the issue by simply disallowing updates to keystone-controlled
    metadata in the credential.
    
    2. Respect token roles when creating EC2 credentials
    
    Without this patch, a trustee, an application credential user, or an
    OAuth1 access token holder could create an EC2 credential or an
    application credential using any roles the trustor, application
    credential creator, or access token authorizor had on the project,
    regardless of whether the creator had delegated only a limited subset of
    roles. This was because the trust_id attribute of the EC2 access blob
    was ignored, and no metadata for the application credential or access
    token was recorded either. This change ensures that the access
    delegation resource is recorded in the metadata of the EC2 credential
    when created and passed to the token provider when used for
    authentication so that the token provider can look up the correct roles
    for the request.
    
    Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9):
          keystone/api/credentials.py
          keystone/tests/unit/test_v3_application_credential.py
          keystone/tests/unit/test_v3_credential.py
    
    Change-Id: I39d0d705839fbe31ac518ac9a82959e108cb7c1d
    Closes-bug: #1872733
    Closes-bug: #1872755
    Closes-bug: #1872735
    (cherry picked from commit 37e9907a176dad6843819b1bec4946c3aecc4548)
    (cherry picked from commit 2f2736ebb267c757ad77fcf25ee0aaeefab2a09d)
    (cherry picked from commit 27caafe3daa552663719954f2cd6713dd4493178)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-stein
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/49" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-13T17:14:44.391225+00:00" title="2020-05-13 17:14:44 UTC">on 2020-05-13</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/49">
                <strong>Fix merged to keystone (stable/rocky)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/49"> #49</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/keystone/+bug/1872733/comments/49/+download">Download full text</a> (3.9 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/725895">https:/<wbr />/review.<wbr />opendev.<wbr />org/725895</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=53d1ccb8a1bdbb5aa0efaacf9739b1a6f436e191">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=53d1ccb8a1b<wbr />dbb5aa0efaacf97<wbr />39b1a6f436e191</a><br />
Submitter: Zuul<br />
Branch:    stable/rocky</p>
<p>commit 53d1ccb8a1bdbb5<wbr />aa0efaacf9739b1<wbr />a6f436e191<br />
Author: Colleen Murphy &lt;email address hidden&gt;<br />
Date:   Tue Apr 14 16:47:44 2020 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix security issues with EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change addresses several issues in the creation and use of EC2/S3<br />
&nbsp;&nbsp;&nbsp;&nbsp;credentials with keystone tokens.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1. Disable altering credential owner attributes or metadata</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, an authenticated user can create an EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;for themself for a project they have a role on, then update the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential to target a user and project completely unrelated to them. In<br />
&nbsp;&nbsp;&nbsp;&nbsp;the worst case, this could be the admin user and a project the admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user has a role assignment on. A token granted for an altered credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;like this would allow the user to masquerade as the victim user. This<br />
&nbsp;&nbsp;&nbsp;&nbsp;patch ensures that when updating a credential, the new form of the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential is one the acting user has access to: if the system admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user is changing the credential, the new user ID or project ID could be<br />
&nbsp;&nbsp;&nbsp;&nbsp;anything, but regular users may only change the credential to be one<br />
&nbsp;&nbsp;&nbsp;&nbsp;that they still own.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Relatedly, when a user uses an application credential or a trust to<br />
&nbsp;&nbsp;&nbsp;&nbsp;create an EC2 credential, keystone automatically adds the trust ID or<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential ID as metadata in the EC2 access blob so that it<br />
&nbsp;&nbsp;&nbsp;&nbsp;knows how the token can be scoped when it is used. Without this patch, a<br />
&nbsp;&nbsp;&nbsp;&nbsp;user who has created a credential in this way can update the access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;to remove or alter this metadata and escalate their privileges to be<br />
&nbsp;&nbsp;&nbsp;&nbsp;fully authorized for the trustor&#x27;s, application credential creator&#x27;s, or<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token authorizor&#x27;s privileges on the project. This patch<br />
&nbsp;&nbsp;&nbsp;&nbsp;fixes the issue by simply disallowing updates to keystone-controlled<br />
&nbsp;&nbsp;&nbsp;&nbsp;metadata in the credential.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2. Respect token roles when creating EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, a trustee, an application credential user, or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token holder could create an EC2 credential or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential using any roles the trustor, application<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential creator, or access token authorizor had on the project,<br />
&nbsp;&nbsp;&nbsp;&nbsp;regardless of whether the creator had delegated only a limited subset of<br />
&nbsp;&nbsp;&nbsp;&nbsp;roles. This was because the trust_id attribute of the EC2 access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;was ignored, and no metadata for the application credential or access<br />
&nbsp;&nbsp;&nbsp;&nbsp;token was recorded either. This change ensures that the access<br />
&nbsp;&nbsp;&nbsp;&nbsp;delegation resource is recorded in the metadata of the EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;when created and passed to the token provider when used for<br />
&nbsp;&nbsp;&nbsp;&nbsp;authentication so that the token provider can look up the correct roles<br />
&nbsp;&nbsp;&nbsp;&nbsp;for the request.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9):<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />api/credentials<wbr />.py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />application_<wbr />credential.<wbr />py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />credential.<wbr />py</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts due to flask reorg:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keys...</p></div>
    
    <p>
      <a href="/keystone/+bug/1872733/comments/49">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/725895
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=53d1ccb8a1bdbb5aa0efaacf9739b1a6f436e191
Submitter: Zuul
Branch:    stable/rocky

commit 53d1ccb8a1bdbb5aa0efaacf9739b1a6f436e191
Author: Colleen Murphy &lt;colleen.murphy@suse.com&gt;
Date:   Tue Apr 14 16:47:44 2020 -0700

    Fix security issues with EC2 credentials
    
    This change addresses several issues in the creation and use of EC2/S3
    credentials with keystone tokens.
    
    1. Disable altering credential owner attributes or metadata
    
    Without this patch, an authenticated user can create an EC2 credential
    for themself for a project they have a role on, then update the
    credential to target a user and project completely unrelated to them. In
    the worst case, this could be the admin user and a project the admin
    user has a role assignment on. A token granted for an altered credential
    like this would allow the user to masquerade as the victim user. This
    patch ensures that when updating a credential, the new form of the
    credential is one the acting user has access to: if the system admin
    user is changing the credential, the new user ID or project ID could be
    anything, but regular users may only change the credential to be one
    that they still own.
    
    Relatedly, when a user uses an application credential or a trust to
    create an EC2 credential, keystone automatically adds the trust ID or
    application credential ID as metadata in the EC2 access blob so that it
    knows how the token can be scoped when it is used. Without this patch, a
    user who has created a credential in this way can update the access blob
    to remove or alter this metadata and escalate their privileges to be
    fully authorized for the trustor's, application credential creator's, or
    OAuth1 access token authorizor's privileges on the project. This patch
    fixes the issue by simply disallowing updates to keystone-controlled
    metadata in the credential.
    
    2. Respect token roles when creating EC2 credentials
    
    Without this patch, a trustee, an application credential user, or an
    OAuth1 access token holder could create an EC2 credential or an
    application credential using any roles the trustor, application
    credential creator, or access token authorizor had on the project,
    regardless of whether the creator had delegated only a limited subset of
    roles. This was because the trust_id attribute of the EC2 access blob
    was ignored, and no metadata for the application credential or access
    token was recorded either. This change ensures that the access
    delegation resource is recorded in the metadata of the EC2 credential
    when created and passed to the token provider when used for
    authentication so that the token provider can look up the correct roles
    for the request.
    
    Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9):
          keystone/api/credentials.py
          keystone/tests/unit/test_v3_application_credential.py
          keystone/tests/unit/test_v3_credential.py
    
    Conflicts due to flask reorg:
            keystone/api/_shared/EC2_S3_Resource.py
            keystone/api/credentials.py
            keystone/api/users.py
            keystone/tests/unit/test_v3_credential.py
    
    Moved the test_update_credential_non_owner unit test to
    CredentialSelfServiceTestCase since in this branch the default policies
    are not affected by #1872733.
    
    Change-Id: I39d0d705839fbe31ac518ac9a82959e108cb7c1d
    Closes-bug: #1872733
    Closes-bug: #1872755
    Closes-bug: #1872735
    (cherry picked from commit 37e9907a176dad6843819b1bec4946c3aecc4548)
    (cherry picked from commit 2f2736ebb267c757ad77fcf25ee0aaeefab2a09d)
    (cherry picked from commit 27caafe3daa552663719954f2cd6713dd4493178)
    (cherry picked from commit bfba75fc3c5c8f119f74dbf31347e008824a2134)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-rocky
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/50" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-05-14T22:09:37.726931+00:00" title="2020-05-14 22:09:37 UTC">on 2020-05-14</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/50">
                <strong>Fix merged to keystone (stable/queens)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/50"> #50</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/keystone/+bug/1872733/comments/50/+download">Download full text</a> (4.3 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/726435">https:/<wbr />/review.<wbr />opendev.<wbr />org/726435</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=487c7276c7608fb11086b9875b0d7cc7cf594a5a">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=487c7276c76<wbr />08fb11086b9875b<wbr />0d7cc7cf594a5a</a><br />
Submitter: Zuul<br />
Branch:    stable/queens</p>
<p>commit 487c7276c7608fb<wbr />11086b9875b0d7c<wbr />c7cf594a5a<br />
Author: Colleen Murphy &lt;email address hidden&gt;<br />
Date:   Tue Apr 14 16:47:44 2020 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix security issues with EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change addresses several issues in the creation and use of EC2/S3<br />
&nbsp;&nbsp;&nbsp;&nbsp;credentials with keystone tokens.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1. Disable altering credential owner attributes or metadata</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, an authenticated user can create an EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;for themself for a project they have a role on, then update the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential to target a user and project completely unrelated to them. In<br />
&nbsp;&nbsp;&nbsp;&nbsp;the worst case, this could be the admin user and a project the admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user has a role assignment on. A token granted for an altered credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;like this would allow the user to masquerade as the victim user. This<br />
&nbsp;&nbsp;&nbsp;&nbsp;patch ensures that when updating a credential, the new form of the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential is one the acting user has access to: if the system admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user is changing the credential, the new user ID or project ID could be<br />
&nbsp;&nbsp;&nbsp;&nbsp;anything, but regular users may only change the credential to be one<br />
&nbsp;&nbsp;&nbsp;&nbsp;that they still own.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Relatedly, when a user uses an application credential or a trust to<br />
&nbsp;&nbsp;&nbsp;&nbsp;create an EC2 credential, keystone automatically adds the trust ID or<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential ID as metadata in the EC2 access blob so that it<br />
&nbsp;&nbsp;&nbsp;&nbsp;knows how the token can be scoped when it is used. Without this patch, a<br />
&nbsp;&nbsp;&nbsp;&nbsp;user who has created a credential in this way can update the access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;to remove or alter this metadata and escalate their privileges to be<br />
&nbsp;&nbsp;&nbsp;&nbsp;fully authorized for the trustor&#x27;s, application credential creator&#x27;s, or<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token authorizor&#x27;s privileges on the project. This patch<br />
&nbsp;&nbsp;&nbsp;&nbsp;fixes the issue by simply disallowing updates to keystone-controlled<br />
&nbsp;&nbsp;&nbsp;&nbsp;metadata in the credential.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2. Respect token roles when creating EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, a trustee, an application credential user, or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token holder could create an EC2 credential or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential using any roles the trustor, application<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential creator, or access token authorizor had on the project,<br />
&nbsp;&nbsp;&nbsp;&nbsp;regardless of whether the creator had delegated only a limited subset of<br />
&nbsp;&nbsp;&nbsp;&nbsp;roles. This was because the trust_id attribute of the EC2 access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;was ignored, and no metadata for the application credential or access<br />
&nbsp;&nbsp;&nbsp;&nbsp;token was recorded either. This change ensures that the access<br />
&nbsp;&nbsp;&nbsp;&nbsp;delegation resource is recorded in the metadata of the EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;when created and passed to the token provider when used for<br />
&nbsp;&nbsp;&nbsp;&nbsp;authentication so that the token provider can look up the correct roles<br />
&nbsp;&nbsp;&nbsp;&nbsp;for the request.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9):<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />api/credentials<wbr />.py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />application_<wbr />credential.<wbr />py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />credential.<wbr />py</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts due to flask reorg:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key...</p></div>
    
    <p>
      <a href="/keystone/+bug/1872733/comments/50">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/726435
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=487c7276c7608fb11086b9875b0d7cc7cf594a5a
Submitter: Zuul
Branch:    stable/queens

commit 487c7276c7608fb11086b9875b0d7cc7cf594a5a
Author: Colleen Murphy &lt;colleen.murphy@suse.com&gt;
Date:   Tue Apr 14 16:47:44 2020 -0700

    Fix security issues with EC2 credentials
    
    This change addresses several issues in the creation and use of EC2/S3
    credentials with keystone tokens.
    
    1. Disable altering credential owner attributes or metadata
    
    Without this patch, an authenticated user can create an EC2 credential
    for themself for a project they have a role on, then update the
    credential to target a user and project completely unrelated to them. In
    the worst case, this could be the admin user and a project the admin
    user has a role assignment on. A token granted for an altered credential
    like this would allow the user to masquerade as the victim user. This
    patch ensures that when updating a credential, the new form of the
    credential is one the acting user has access to: if the system admin
    user is changing the credential, the new user ID or project ID could be
    anything, but regular users may only change the credential to be one
    that they still own.
    
    Relatedly, when a user uses an application credential or a trust to
    create an EC2 credential, keystone automatically adds the trust ID or
    application credential ID as metadata in the EC2 access blob so that it
    knows how the token can be scoped when it is used. Without this patch, a
    user who has created a credential in this way can update the access blob
    to remove or alter this metadata and escalate their privileges to be
    fully authorized for the trustor's, application credential creator's, or
    OAuth1 access token authorizor's privileges on the project. This patch
    fixes the issue by simply disallowing updates to keystone-controlled
    metadata in the credential.
    
    2. Respect token roles when creating EC2 credentials
    
    Without this patch, a trustee, an application credential user, or an
    OAuth1 access token holder could create an EC2 credential or an
    application credential using any roles the trustor, application
    credential creator, or access token authorizor had on the project,
    regardless of whether the creator had delegated only a limited subset of
    roles. This was because the trust_id attribute of the EC2 access blob
    was ignored, and no metadata for the application credential or access
    token was recorded either. This change ensures that the access
    delegation resource is recorded in the metadata of the EC2 credential
    when created and passed to the token provider when used for
    authentication so that the token provider can look up the correct roles
    for the request.
    
    Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9):
          keystone/api/credentials.py
          keystone/tests/unit/test_v3_application_credential.py
          keystone/tests/unit/test_v3_credential.py
    
    Conflicts due to flask reorg:
            keystone/api/_shared/EC2_S3_Resource.py
            keystone/api/credentials.py
            keystone/api/users.py
            keystone/tests/unit/test_v3_credential.py
    
    Conflicts due to token provider refactor between Queens and Rocky. Also
    conflicted due to changing method signature for _authenticate().
        keystone/credential/controllers.py
        keystone/contrib/ec2/controllers.py
        keystone/application_credential/controllers.py
        keystone/token/providers/common.py
    
    Moved the test_update_credential_non_owner unit test to
    CredentialSelfServiceTestCase since in this branch the default policies
    are not affected by #1872733.
    
    Change-Id: I39d0d705839fbe31ac518ac9a82959e108cb7c1d
    Closes-bug: #1872733
    Closes-bug: #1872755
    Closes-bug: #1872735
    (cherry picked from commit 37e9907a176dad6843819b1bec4946c3aecc4548)
    (cherry picked from commit 2f2736ebb267c757ad77fcf25ee0aaeefab2a09d)
    (cherry picked from commit 27caafe3daa552663719954f2cd6713dd4493178)
    (cherry picked from commit bfba75fc3c5c8f119f74dbf31347e008824a2134)
    (cherry picked from commit 53d1ccb8a1bdbb5aa0efaacf9739b1a6f436e191)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-queens
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1872733/comments/51" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-06-04T20:12:47.539549+00:00" title="2020-06-04 20:12:47 UTC">on 2020-06-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1872733/comments/51">
                <strong>Fix merged to keystone (stable/pike)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1872733/comments/51"> #51</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/keystone/+bug/1872733/comments/51/+download">Download full text</a> (4.2 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/726046">https:/<wbr />/review.<wbr />opendev.<wbr />org/726046</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=a405e4b71d7de31e81a01f07e02f189650eb66fe">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=a405e4b71d7<wbr />de31e81a01f07e0<wbr />2f189650eb66fe</a><br />
Submitter: Zuul<br />
Branch:    stable/pike</p>
<p>commit a405e4b71d7de31<wbr />e81a01f07e02f18<wbr />9650eb66fe<br />
Author: Colleen Murphy &lt;email address hidden&gt;<br />
Date:   Tue Apr 14 16:47:44 2020 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix security issues with EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change addresses several issues in the creation and use of EC2/S3<br />
&nbsp;&nbsp;&nbsp;&nbsp;credentials with keystone tokens.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;1. Disable altering credential owner attributes or metadata</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, an authenticated user can create an EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;for themself for a project they have a role on, then update the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential to target a user and project completely unrelated to them. In<br />
&nbsp;&nbsp;&nbsp;&nbsp;the worst case, this could be the admin user and a project the admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user has a role assignment on. A token granted for an altered credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;like this would allow the user to masquerade as the victim user. This<br />
&nbsp;&nbsp;&nbsp;&nbsp;patch ensures that when updating a credential, the new form of the<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential is one the acting user has access to: if the system admin<br />
&nbsp;&nbsp;&nbsp;&nbsp;user is changing the credential, the new user ID or project ID could be<br />
&nbsp;&nbsp;&nbsp;&nbsp;anything, but regular users may only change the credential to be one<br />
&nbsp;&nbsp;&nbsp;&nbsp;that they still own.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Relatedly, when a user uses an application credential or a trust to<br />
&nbsp;&nbsp;&nbsp;&nbsp;create an EC2 credential, keystone automatically adds the trust ID or<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential ID as metadata in the EC2 access blob so that it<br />
&nbsp;&nbsp;&nbsp;&nbsp;knows how the token can be scoped when it is used. Without this patch, a<br />
&nbsp;&nbsp;&nbsp;&nbsp;user who has created a credential in this way can update the access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;to remove or alter this metadata and escalate their privileges to be<br />
&nbsp;&nbsp;&nbsp;&nbsp;fully authorized for the trustor&#x27;s, application credential creator&#x27;s, or<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token authorizor&#x27;s privileges on the project. This patch<br />
&nbsp;&nbsp;&nbsp;&nbsp;fixes the issue by simply disallowing updates to keystone-controlled<br />
&nbsp;&nbsp;&nbsp;&nbsp;metadata in the credential.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;2. Respect token roles when creating EC2 credentials</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Without this patch, a trustee, an application credential user, or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;OAuth1 access token holder could create an EC2 credential or an<br />
&nbsp;&nbsp;&nbsp;&nbsp;application credential using any roles the trustor, application<br />
&nbsp;&nbsp;&nbsp;&nbsp;credential creator, or access token authorizor had on the project,<br />
&nbsp;&nbsp;&nbsp;&nbsp;regardless of whether the creator had delegated only a limited subset of<br />
&nbsp;&nbsp;&nbsp;&nbsp;roles. This was because the trust_id attribute of the EC2 access blob<br />
&nbsp;&nbsp;&nbsp;&nbsp;was ignored, and no metadata for the application credential or access<br />
&nbsp;&nbsp;&nbsp;&nbsp;token was recorded either. This change ensures that the access<br />
&nbsp;&nbsp;&nbsp;&nbsp;delegation resource is recorded in the metadata of the EC2 credential<br />
&nbsp;&nbsp;&nbsp;&nbsp;when created and passed to the token provider when used for<br />
&nbsp;&nbsp;&nbsp;&nbsp;authentication so that the token provider can look up the correct roles<br />
&nbsp;&nbsp;&nbsp;&nbsp;for the request.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9):<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />api/credentials<wbr />.py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />application_<wbr />credential.<wbr />py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;keystone/<wbr />tests/unit/<wbr />test_v3_<wbr />credential.<wbr />py</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts due to flask reorg:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyst.<wbr />..</p></div>
    
    <p>
      <a href="/keystone/+bug/1872733/comments/51">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/726046
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=a405e4b71d7de31e81a01f07e02f189650eb66fe
Submitter: Zuul
Branch:    stable/pike

commit a405e4b71d7de31e81a01f07e02f189650eb66fe
Author: Colleen Murphy &lt;colleen.murphy@suse.com&gt;
Date:   Tue Apr 14 16:47:44 2020 -0700

    Fix security issues with EC2 credentials
    
    This change addresses several issues in the creation and use of EC2/S3
    credentials with keystone tokens.
    
    1. Disable altering credential owner attributes or metadata
    
    Without this patch, an authenticated user can create an EC2 credential
    for themself for a project they have a role on, then update the
    credential to target a user and project completely unrelated to them. In
    the worst case, this could be the admin user and a project the admin
    user has a role assignment on. A token granted for an altered credential
    like this would allow the user to masquerade as the victim user. This
    patch ensures that when updating a credential, the new form of the
    credential is one the acting user has access to: if the system admin
    user is changing the credential, the new user ID or project ID could be
    anything, but regular users may only change the credential to be one
    that they still own.
    
    Relatedly, when a user uses an application credential or a trust to
    create an EC2 credential, keystone automatically adds the trust ID or
    application credential ID as metadata in the EC2 access blob so that it
    knows how the token can be scoped when it is used. Without this patch, a
    user who has created a credential in this way can update the access blob
    to remove or alter this metadata and escalate their privileges to be
    fully authorized for the trustor's, application credential creator's, or
    OAuth1 access token authorizor's privileges on the project. This patch
    fixes the issue by simply disallowing updates to keystone-controlled
    metadata in the credential.
    
    2. Respect token roles when creating EC2 credentials
    
    Without this patch, a trustee, an application credential user, or an
    OAuth1 access token holder could create an EC2 credential or an
    application credential using any roles the trustor, application
    credential creator, or access token authorizor had on the project,
    regardless of whether the creator had delegated only a limited subset of
    roles. This was because the trust_id attribute of the EC2 access blob
    was ignored, and no metadata for the application credential or access
    token was recorded either. This change ensures that the access
    delegation resource is recorded in the metadata of the EC2 credential
    when created and passed to the token provider when used for
    authentication so that the token provider can look up the correct roles
    for the request.
    
    Conflicts (six removal in  e2d83ae9, pep8 fixes in e2d83ae9):
          keystone/api/credentials.py
          keystone/tests/unit/test_v3_application_credential.py
          keystone/tests/unit/test_v3_credential.py
    
    Conflicts due to flask reorg:
            keystone/api/_shared/EC2_S3_Resource.py
            keystone/api/credentials.py
            keystone/api/users.py
            keystone/tests/unit/test_v3_credential.py
    
    Moved the test_update_credential_non_owner unit test to
    CredentialSelfServiceTestCase since in this branch the default policies
    are not affected by #1872733.
    
    NOTE: the application credential functional changes, along with its
    tests were removed from the stable/pike backport as stable/pike does not
    support application credentials.
    
    Change-Id: I39d0d705839fbe31ac518ac9a82959e108cb7c1d
    Closes-bug: #1872733
    Closes-bug: #1872755
    Closes-bug: #1872735
    (cherry picked from commit 37e9907a176dad6843819b1bec4946c3aecc4548)
    (cherry picked from commit 2f2736ebb267c757ad77fcf25ee0aaeefab2a09d)
    (cherry picked from commit 27caafe3daa552663719954f2cd6713dd4493178)
    (cherry picked from commit bfba75fc3c5c8f119f74dbf31347e008824a2134)
    (cherry picked from commit 53d1ccb8a1bdbb5aa0efaacf9739b1a6f436e191)
    (cherry picked from commit 6db1bb09a048dfb7f337484698a9a19fdbbe9546)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-pike
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/keystone/+bug/1872733/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/keystone/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/keystone/+bug/1872733/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    <li class="sprite bug-dupe">
    <span id="mark-duplicate-text">
    <a class="menu-link-mark-dupe" href="/keystone/+bug/1872733/+duplicate">Mark as duplicate</a>
    </span>
    </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/keystone/+bug/1872733/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/keystone/+bug/1872733/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/keystone/+bug/1872733/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    <li><a class="menu-link-unlinkcve sprite modify remove" href="https://bugs.launchpad.net/keystone/+bug/1872733/+unlinkcve">Remove CVE link</a></li>
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/keystone/+bug/1872733/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/keystone/+bug/1872733/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/keystone/+bug/1872733/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  <div class="portlet" id="portlet-patches">
    <h2>Patches</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5354247/+files/0001-Disable-altering-credential-owner-attributes.patch">0001-Disable-altering-credential-owner-attributes.patch</a>
        <small>
          (<a href="/keystone/+bug/1872733/+attachment/5354247">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5355724/+files/0001-Disable-altering-credential-owner-attributes.patch">0001-Disable-altering-credential-owner-attributes.patch</a>
        <small>
          (<a href="/keystone/+bug/1872733/+attachment/5355724">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5363821/+files/0001-Disable-altering-credential-owner-attributes.patch-train">train</a>
        <small>
          (<a href="/keystone/+bug/1872733/+attachment/5363821">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5363822/+files/0001-Disable-altering-credential-owner-attributes.patch-stein">0001-Disable-altering-credential-owner-attributes.patch-stein</a>
        <small>
          (<a href="/keystone/+bug/1872733/+attachment/5363822">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/keystone/+bug/1872733/+addcomment?field.patch=on">Add patch</a>
      </li>
    </ul>
  </div>
  <div class="portlet" id="portlet-attachments">
    <h2>Bug attachments</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/keystone/+bug/1872733/+attachment/5365987/+files/bug-1872733.diff">bug-1872733.diff</a>
        <small>
          (<a href="/keystone/+bug/1872733/+attachment/5365987">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/keystone/+bug/1872733/+addcomment">Add attachment</a>
      </li>
    </ul>
  </div>


      

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"bug_is_private": false, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1872733", "web_link": "https://bugs.launchpad.net/bugs/1872733", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 1872733, "private": false, "information_type": "Public Security", "name": null, "title": "[OSSA-2020-004] Keystone V3 /credentials endpoint policy logic allows to change credentials owner or target project ID (CVE-2020-12691)", "description": "\"_build_target_enforcement\" function checks only for \"credential_id\": https://github.com/openstack/keystone/blob/7bb6314e40d6947294260324e84a58de191f8609/keystone/api/credentials.py#L38\n\nThus even having a '\"identity:update_credential\": \"rule:cloud_admin or (user_id:%(target.credential.user_id)s)\"' policy doesn't prevent a malicious user to create an EC2 credential, then change its owner and project ID, e.g.:\n\ncurl -X PATCH https://keystone/v3/credentials/3c2b3265350c6da3a18a143fbe975ca4a8ed88a6f8c6dacc2494a5c1287ba66f -H 'Accept: application/json' -H 'Content-Type: application/json' -H \"X-Auth-Token: ***\" -d'{\n\u00a0\u00a0\"credential\": {\n\u00a0\u00a0\u00a0\u00a0\"project_id\": \"_target_project_id_\",\n\u00a0\u00a0\u00a0\u00a0\"user_id\": \"_target_user_id_\"\n\u00a0\u00a0}\n}'\n\nAdditionally it is possible to Create a credential with any existing project_id, though it doesn't have a serious security issue, e.g.:\n\n{\n\u00a0\u00a0\"credential\": {\n\u00a0\u00a0\u00a0\u00a0\"blob\": \"{\\\"access\\\": \\\"ffe6fc21b47c4d87befc95ad070c3b7a\\\", \\\"secret\\\": \\\"530196cd097e4a7ca9df7258aa89ff0e\\\", \\\"trust_id\\\": null}\",\n\u00a0\u00a0\u00a0\u00a0\"id\": \"3c2b3265350c6da3a18a143fbe975ca4a8ed88a6f8c6dacc2494a5c1287ba66f\",\n\u00a0\u00a0\u00a0\u00a0\"project_id\": \"_any_project_id_\",\n\u00a0\u00a0\u00a0\u00a0\"type\": \"ec2\",\n\u00a0\u00a0\u00a0\u00a0\"user_id\": \"_my_user_id_\"\n\u00a0\u00a0}\n}", "owner_link": "https://bugs.launchpad.net/api/devel/~kay-diam", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/bug_tasks", "duplicate_of_link": null, "date_created": "2020-04-14T14:44:26.767032+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/subscriptions", "date_last_updated": "2020-06-04T20:12:48.934945+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 264, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/attachments", "security_related": true, "latest_patch_uploaded": "2020-04-30T04:03:14.273817+00:00", "tags": ["in-stable-pike", "in-stable-queens", "in-stable-rocky", "in-stable-stein", "in-stable-train", "in-stable-ussuri"], "date_last_message": "2020-06-04T20:12:47.539549+00:00", "number_of_duplicates": 0, "message_count": 52, "users_affected_count": 1, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/users_unaffected", "users_affected_count_with_dupes": 1, "other_users_affected_count_with_dupes": 1, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1872733/linked_merge_proposals", "http_etag": "\"1afa05f08f71b0b5366e634c0d5c98e020c9f478-e08a9fb2180290a3e176bf730c1757a0b4fa9574\""}, "total_comments_and_activity": 82, "related_features": {}, "information_type_data": {"PUBLIC": {"is_private": false, "name": "Public", "order": 0, "description": "Everyone can see this information.\n", "value": "PUBLIC", "description_css_class": "choice-description"}, "PRIVATESECURITY": {"is_private": true, "name": "Private Security", "order": 2, "description": "Only the security group can see this information.\n ", "value": "PRIVATESECURITY", "description_css_class": "choice-description"}, "PUBLICSECURITY": {"is_private": false, "name": "Public Security", "order": 1, "description": "Everyone can see this security related information.\n", "value": "PUBLICSECURITY", "description_css_class": "choice-description"}, "USERDATA": {"is_private": true, "name": "Private", "order": 3, "description": "Only shared with users permitted to see private user information.\n", "value": "USERDATA", "description_css_class": "choice-description"}}, "context": {"self_link": "https://bugs.launchpad.net/api/devel/keystone/+bug/1872733", "web_link": "https://bugs.launchpad.net/keystone/+bug/1872733", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/1872733", "milestone_link": null, "status": "Fix Released", "importance": "High", "assignee_link": "https://bugs.launchpad.net/api/devel/~krinkle", "bug_target_display_name": "OpenStack Identity (keystone)", "bug_target_name": "keystone", "bug_watch_link": null, "date_assigned": "2020-04-15T00:26:38.284599+00:00", "date_created": "2020-04-14T14:44:26.767032+00:00", "date_confirmed": "2020-04-14T22:01:49.856975+00:00", "date_incomplete": null, "date_in_progress": "2020-04-15T00:26:43.318651+00:00", "date_closed": "2020-05-08T16:14:54.037900+00:00", "date_left_new": "2020-04-14T22:01:49.856975+00:00", "date_triaged": "2020-04-14T22:01:49.856975+00:00", "date_fix_committed": "2020-05-08T16:14:54.037900+00:00", "date_fix_released": "2020-05-08T16:14:54.037900+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~kay-diam", "target_link": "https://bugs.launchpad.net/api/devel/keystone", "title": "Bug #1872733 in OpenStack Identity (keystone): \"[OSSA-2020-004] Keystone V3 /credentials endpoint policy logic allows to change credentials owner or target project ID (CVE-2020-12691)\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/keystone/+bug/1872733/related_tasks", "is_complete": true, "http_etag": "\"3af56eb37a0d8e1e90fc9e20e4e36597a0e7b84e-42770beb781073e038a385d74163764a492a723e\""}, "bugtask_data": {"2591945": {"delete_link": "https://bugs.launchpad.net/ossa/+bug/1872733/+delete", "bug_title": "[OSSA-2020-004] Keystone V3 /credentials endpoint policy logic allows to change credentials owner or target project ID (CVE-2020-12691)", "user_can_unassign": false, "importance_value": "Undecided", "user_can_edit_importance": false, "assignee_vocabulary": "AllUserTeamsParticipation", "hide_assignee_team_selection": true, "user_can_edit_status": true, "user_can_delete": false, "row_id": "tasksummary2591945", "target_is_product": true, "user_can_edit_milestone": false, "prefix": "ossa", "bugtask_path": "/ossa/+bug/1872733", "id": 2591945, "milestone_value": null, "status_widget_items": "[]", "milestone_widget_items": "[]", "form_row_id": "task2591945", "targetname": "OpenStack Security Advisory", "assignee_is_team": null, "assignee_vocabulary_filters": [], "user_can_edit_assignee": false, "importance_widget_items": "[]", "assignee_value": null, "status_value": "Fix Released"}, "2591941": {"delete_link": "https://bugs.launchpad.net/keystone/+bug/1872733/+delete", "bug_title": "[OSSA-2020-004] Keystone V3 /credentials endpoint policy logic allows to change credentials owner or target project ID (CVE-2020-12691)", "user_can_unassign": false, "importance_value": "High", "user_can_edit_importance": false, "assignee_vocabulary": "AllUserTeamsParticipation", "hide_assignee_team_selection": true, "user_can_edit_status": true, "user_can_delete": false, "row_id": "tasksummary2591941", "target_is_product": true, "user_can_edit_milestone": false, "prefix": "keystone", "bugtask_path": "/keystone/+bug/1872733", "id": 2591941, "milestone_value": null, "status_widget_items": "[]", "milestone_widget_items": "[]", "form_row_id": "task2591941", "targetname": "OpenStack Identity (keystone)", "assignee_is_team": false, "assignee_vocabulary_filters": [], "user_can_edit_assignee": false, "importance_widget_items": "[]", "assignee_value": "krinkle", "status_value": "Fix Released"}}, "subscribers_portlet_url_data": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1872733", "web_link": "https://bugs.launchpad.net/bugs/1872733"}, "initial_comment_batch_offset": 41, "first visible_recent_comment": 11};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 58 queries/external actions issued in 2.19 seconds

    Features: {'app.maintenance_message': None, 'hard_timeout': '9000', 'js.yui_version': None, 'app.mainsite_only.canonical_url': None, 'disclosure.dsp_picker.enabled': 'on', 'baselayout.careers_link.disabled': None, 'bugs.affected_count_includes_dupes.disabled': None, 'visible_render_time': None, 'profiling.enabled': None, 'bugs.nominations.bug_supervisors_can_target': 'on'}

    r0d8de2b

    -->

</html>

