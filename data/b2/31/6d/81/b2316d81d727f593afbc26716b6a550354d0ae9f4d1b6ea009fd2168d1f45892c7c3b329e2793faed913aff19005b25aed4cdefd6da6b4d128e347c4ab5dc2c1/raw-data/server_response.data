<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>2359906c4fdfa9d44b045755d23fe5327c10e010 - chromium/src/net - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://chromium.googlesource.com/login/chromium/src/net/%2B/2359906c4fdfa9d44b045755d23fe5327c10e010">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">chromium</a> / <a class="Breadcrumbs-crumb" href="/chromium/">chromium</a> / <a class="Breadcrumbs-crumb" href="/chromium/src/">src</a> / <a class="Breadcrumbs-crumb" href="/chromium/src/net/">net</a> / <span class="Breadcrumbs-crumb">2359906c4fdfa9d44b045755d23fe5327c10e010</span></div><div class="u-monospace Metadata"><table><tr><th class="Metadata-title">commit</th><td>2359906c4fdfa9d44b045755d23fe5327c10e010</td><td><span>[<a href="/chromium/src/net/+log/2359906c4fdfa9d44b045755d23fe5327c10e010">log</a>]</span> <span>[<a href="/chromium/src/net/+archive/2359906c4fdfa9d44b045755d23fe5327c10e010.tar.gz">tgz</a>]</span></td></tr><tr><th class="Metadata-title">author</th><td>Adam Rice &lt;ricea@chromium.org&gt;</td><td>Fri Feb 20 05:33:25 2015</td></tr><tr><th class="Metadata-title">committer</th><td>Adam Rice &lt;ricea@chromium.org&gt;</td><td>Fri Feb 20 05:35:09 2015</td></tr><tr><th class="Metadata-title">tree</th><td><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/">7e71908ec8aa517cc95d69cc196cf429622f8c6a</a></td></tr><tr><th class="Metadata-title">parent</th><td><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E">8988100cd9a3cf3bb0b456ecadc77b8f85702ddd</a> <span>[<a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E%21/">diff</a>]</span></td></tr></table></div><pre class="u-pre u-monospace MetadataMessage">Apply HSTS to WebSocket connections.

With this change, ws: connections to hosts which have an existing HSTS
pin will be automatically changed to use wss:, ie. SSL.

In addition, Strict-Transport-Security headers that are sent from a wss:
server with a valid SSL certificate will be enforced on subsequent ws:
and http: connections to the same host.

This CL also modifies HttpNetworkTransaction to treat wss: the same as
https:.

BUG=455215, 446480
TEST=net_unittests
R=rsleevi@chromium.org, tyoshino@chromium.org

Review URL: <a href="https://codereview.chromium.org/903553005">https://codereview.chromium.org/903553005</a>

Cr-Original-Commit-Position: refs/heads/master@{#317252}
Cr-Mirrored-From: <a href="https://chromium.googlesource.com/chromium/src">https://chromium.googlesource.com/chromium/src</a>
Cr-Mirrored-Commit: cb76ac67dca0a133cdfa96678ac5cd2a65af96a3
</pre><ul class="DiffTree"><li><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/data/websocket/set-hsts_wsh.py">data/websocket/set-hsts_wsh.py</a><span class="DiffTree-action DiffTree-action--add">[Added - <a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E%21/#F0">diff</a>]</span></li><li><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/http/http_network_transaction.cc">http/http_network_transaction.cc</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E%21/#F1">diff</a>]</span></li><li><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/http/http_network_transaction.h">http/http_network_transaction.h</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E%21/#F2">diff</a>]</span></li><li><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/http/http_network_transaction_unittest.cc">http/http_network_transaction_unittest.cc</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E%21/#F3">diff</a>]</span></li><li><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/url_request/url_request.cc">url_request/url_request.cc</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E%21/#F4">diff</a>]</span></li><li><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/url_request/url_request_unittest.cc">url_request/url_request_unittest.cc</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E%21/#F5">diff</a>]</span></li><li><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/websockets/websocket_end_to_end_test.cc">websockets/websocket_end_to_end_test.cc</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E%21/#F6">diff</a>]</span></li><li><a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/websockets/websocket_stream.cc">websockets/websocket_stream.cc</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010%5E%21/#F7">diff</a>]</span></li></ul><div class="DiffSummary">8 files changed</div><div class="TreeDetail"><div class="u-sha1 u-monospace TreeDetail-sha1">tree: 7e71908ec8aa517cc95d69cc196cf429622f8c6a</div><ol class="FileList"><li class="FileList-item FileList-item--regularFile" title="Regular file - BUILD.gn"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/BUILD.gn">BUILD.gn</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - DEPS"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/DEPS">DEPS</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - OWNERS"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/OWNERS">OWNERS</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - PRESUBMIT.py"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/PRESUBMIT.py">PRESUBMIT.py</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - android/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/android/">android/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - base/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/base/">base/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - cert/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/cert/">cert/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - cookies/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/cookies/">cookies/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - data/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/data/">data/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - disk_cache/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/disk_cache/">disk_cache/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - dns/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/dns/">dns/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - docs/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/docs/">docs/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - extras/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/extras/">extras/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - filter/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/filter/">filter/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - ftp/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/ftp/">ftp/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - http/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/http/">http/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - interfaces/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/interfaces/">interfaces/</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - net.gyp"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/net.gyp">net.gyp</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - net.gypi"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/net.gypi">net.gypi</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - net.isolate"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/net.isolate">net.isolate</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - net_nacl.gyp"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/net_nacl.gyp">net_nacl.gyp</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - net_unittests.isolate"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/net_unittests.isolate">net_unittests.isolate</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - ocsp/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/ocsp/">ocsp/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - proxy/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/proxy/">proxy/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - quic/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/quic/">quic/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - sdch/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/sdch/">sdch/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - server/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/server/">server/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - socket/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/socket/">socket/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - spdy/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/spdy/">spdy/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - ssl/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/ssl/">ssl/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - test/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/test/">test/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - third_party/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/third_party/">third_party/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - tools/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/tools/">tools/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - udp/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/udp/">udp/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - url_request/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/url_request/">url_request/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - websockets/"><a class="FileList-itemLink" href="/chromium/src/net/+/2359906c4fdfa9d44b045755d23fe5327c10e010/websockets/">websockets/</a></li></ol></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>